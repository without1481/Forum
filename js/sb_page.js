/*=======================================================================*\
|| ###################################################################### ||
|| # vBulletin 5.3.4
|| # ------------------------------------------------------------------ # ||
|| # Copyright 2000-2017 vBulletin Solutions Inc. All Rights Reserved.  # ||
|| # This file may not be redistributed in whole or significant part.   # ||
|| # ----------------- VBULLETIN IS NOT FREE SOFTWARE ----------------- # ||
|| # http://www.vbulletin.com | http://www.vbulletin.com/license.html   # ||
|| ###################################################################### ||
\*========================================================================*/
window.vBulletin=window.vBulletin||{};window.vBulletin.phrase=window.vBulletin.phrase||{};window.vBulletin.phrase.precache=window.vBulletin.phrase.precache||[];window.vBulletin.phrase.precache=$.merge(window.vBulletin.phrase.precache,["action","active","ad_list_description","add_modules","add_subforum","adding_multiple_modules_not_allowed","all","applying_new_template","are_you_sure_want_to_delete_ad_x","cancel","cannot_add_system_module","cannot_convert_channel","cannot_remove_system_module","channels","check_to_hide_module","choose_base_module","choose_options_site_logo","click_text_edit_title","confirm_deletion_gcpglobal","confirm_deletion_x","confirm_remove_page_desc","content_types","create_ad","create_new_custom_module","delete","display_order","do_you_want_to_cancel_editing_search_module","do_you_want_to_exit_without_saving_page","do_you_want_to_remove_channel","do_you_want_to_remove_forum","do_you_want_to_remove_module","do_you_want_to_remove_tab","drag_and_drop_module_here","drop_page_here","dropping_container_module_into_container_module_not_allowed","edit","edit_ad_x","edit_blog_categories","edit_custom_html_module","edit_navigation_item","edit_search_module","edit_site_logo","error_adding_widgets","error_cloning_widget","error_deleting_page","error_fetching_channels","error_loading_search_config_script","error_processing_site_logo","error_processing_site_logo_image_hosting","error_renaming_module_title","error_retrieving_cloned_widget_template","error_retrieving_configuration","error_retrieving_list_user_groups","error_retrieving_modules","error_retrieving_navigation_bar_configuration","error_retrieving_page_map","error_retrieving_templates","error_saving_configuration_module","error_saving_forums","error_saving_forums_code","error_saving_navigation_bar_configuration","error_saving_page","error_saving_search_config","error_saving_search_config_code","error_saving_site_logo","error_saving_site_logo_code","error_uploading_logo","exit_without_saving_page","expand","forum_changes_will_be_lost","input_navigation_item_name","input_target_url","invalid_image_url","main_navigation_bar","make_category","make_forum","manage_ads","module_configuration","module_icon","move_not_allowed","moving_main_nav_to_own_sub_nav_error","moving_main_nav_with_sub_nav_error","new_navigation_item","new_subnavigation_item","next","no","no_ad_added","no_configurations_found","no_modules","no_permission","none","overwrite_template_continue","page_template_title_cannot_be_empty","page_title_cannot_be_empty","please_choose_overwrite_template_options","please_enter_channel_title","please_enter_new_module_title","please_enter_new_template_name","please_enter_page_name","previous","remove_channel","remove_channel_q","remove_forum","remove_forum_q","remove_module_q","rename","rename_custom_module","reset","save","save_new_page","save_page","search_results","select_edit_link_header","special_options","sub_navigation_bar","subchannels_will_be_deleted","switch_template","template_changes_will_be_lost","this_url_is_already_used","title","unable_to_delete_widget_instances","uncheck_to_unhide_module","url_too_long","user_group_settings","warning","warning_gcpuser","yes","you_are_here","you_can_also_drag_and_drop_modules_here","you_cannot_revert_this_layout_confirm","you_must_specify_a_screen_layout"]);(function(AU){var f,AT,n,Ac,AE,a,AA=[],AC,AI,s=false,v=false,o={},y=false,AF=false,d=false,l=false,u=false,AZ=false,S=false,t=false,h={},x={},AN={},H={},b,AM,q,Aa={saveNewWidgetInstance:false},A=AU("<div>"),P;function Aj(){window.setTimeout(function(){if(vBulletin.vBScroller&&vBulletin.vBScroller.initializeScroller){AU(".js-vbscroller-wrapper:visible").each(function(){vBulletin.vBScroller.initializeScroller(AU(this))})}},0)}function Ai(){var Al=AU("#edit-page-dropdown .panel .panel-main-content:visible");if(Al.length>0){var Ak=parseFloat(Al.css("margin-left"))+parseFloat(Al.css("margin-right"))+parseFloat(Al.css("border-left-width"))+parseFloat(Al.css("border-right-width"))+parseFloat(Al.css("padding-left"))+parseFloat(Al.css("padding-right"));AU("#edit-page-dropdown .panel .panel-main-content").width(AU("#edit-page-dropdown .panel:visible").width()-AU("#edit-page-dropdown .panel .panel-header-text:visible").outerWidth(true)-Ak-1);AU("#edit-page-dropdown form .form-gutter-right").width(Math.ceil((AU("#edit-page-dropdown form:visible").width()-AU("#edit-page-dropdown .panel:visible").outerWidth(true))/2));Aj()}}function AV(Al,An){if(AU.isEmptyObject(An)){return }var Am=Al.find(".js-admin-widget-list"),Ak=false;AU.each(An,function(){Am.append(this.rendered_template);Ak=true});if(Ak){Am.closest(".js-widget-content").removeClass("h-hide")}Am.closest(".js-widget-content").css({minHeight:"35px"});Am.css({minHeight:"0",height:"auto",paddingBottom:"10px"})}function AL(An,Ak,Ap){var Al=An.attr("data-widget-id"),Ao=An.attr("data-widget-instance-id")||"",Am={widgetinstanceid:Ao,widgetid:Al,guid:"",userid:0,channelId:0,withTemplate:false,};if(typeof Ap=="undefined"){Ap=false}else{Ap=Boolean(Ap)}vBulletin.AJAX({call:"/ajax/api/widget/fetchConfigAndIsUserEditable",data:Am,success:function(Aq){console.log("fetchConfig in getModuleConfig() successful! result:"+JSON.stringify(Aq));var Ar=Aq;if(!Ap){Ar=Aq.config}if(typeof Ak=="function"){Ak(Ar)}}})}function AB(Al){if(!Al.tab_data){Al.tab_data=[]}if(!Al.default_tab){Al.default_tab=0}if(!Al.submodules_key){console.log({msg:"Missing submodules key!",config:Al,});Al.submodules_key="tabbedContainerSubModules__temp"}if(!Al.display_tabs){Al.display_tabs=""}if(Al.display_tabs==""){var Ak={};AU.each(Al.tab_data,function(An,Am){Ak[An]="1"});Al.display_tabs=Ak}return Al}function W(){if(typeof q=="undefined"){q=AU("#config_pagetemplateid").val()||AU("#select-template input[type=radio]:checked").val()||""}return q}function c(Ak){Ak=parseInt(Ak,10);q=Ak;AU("#config_pagetemplateid, #save-page-form #pagetemplateid-yes, #save-page-form #pagetemplateid-new").val(q)}function Z(Al,Ak){console.log({msg:"saveModuleConfig()",$module:Al,config:Ak,});vBulletin.AJAX({call:"/ajax/api/widget/saveAdminConfig",data:{widgetid:Al.attr("data-widget-id"),widgetinstanceid:Al.attr("data-widget-instance-id")||"",pagetemplateid:W(),data:Ak},complete:function(){AU("body").css("cursor","auto")},success:function(Am){console.log("saveAdminConfig in saveModuleConfig() successful! result:"+JSON.stringify(Am))}})}function r(Al){var Ak=Al.parents(".canvas-widget");if(Ak.length){$parentModule=AU(Ak[0]);return parseInt($parentModule.data("widget-instance-id"),10)}return 0}function R(Al){var Ak=Al.parents(".canvas-widget[data-is-tabbed-container='true']");if(Al.data("is-tabbed-container")){console.log("---updating self tabbed container config");V(Al)}if(Ak.length==0){console.log("---no parent tabbed container to update");return }console.log("---updating parent tabbed container config");V(AU(Ak[0]))}function g(Al){var Ak={};Al.find("> .js-admin-widget-content > .js-admin-widget-tab").each(function(){var Ap=AU(this),Ao=[],Am=Ap&&Ap.data("tab-number")||0,An=Ap&&Ap.data("tab-title")||"";Ak[Am]={title:An};Ap.find("> .widget-content > .canvas-layout-row > .canvas-widget-list > .canvas-widget:not(.dummy-widget)").each(function(){var At=AU(this),Aq=At.data("widget-id"),Ar=At.data("widget-instance-id")||At.attr("data-widget-instance-id"),As={};if(Ar){As.widgetinstanceid=Ar}if(Aq){As.widgetid=Aq}if(!AU.isEmptyObject(As)){Ao.push(As)}});Ak[Am]["widgets"]=Ao});return Ak}function V(Al){var Ak=function(Am){var Am=AB(Am);Am.tab_data=g(Al);if(!AU.isEmptyObject(Am)){Z(Al,Am)}};AL(Al,Ak)}function AP(Ak){vBulletin.AJAX({call:"/ajax/api/widget/deleteWidgetInstances",data:{widgetInstanceIds:Ak},success:function(Al){console.log("saveAdminConfig in saveModuleConfig() successful! removeInstances: "+JSON.stringify(Ak)+" result:"+JSON.stringify(Al))},emptyResponse:function(Al){console.log("Empty response from deleteWidgetInstances after parent tab delete.")},api_error:vBulletin.ajaxtools.logApiError,})}function j(Ao,An,Al,Ap){var Aq=W(),Am=(Aq==""||Aq==0),Ak="save-new-widgetinstance-pagetemplateid-ready";if(Am){if(!Aa.saveNewWidgetInstance){Aa.saveNewWidgetInstance=true}else{A.one(Ak,function(Ar){j(Ao,An,Al,Ap)});return }}vBulletin.AJAX({call:"/ajax/api/widget/saveNewWidgetInstance",data:{containerinstanceid:Ao,widgetid:An,pagetemplateid:Aq,subWidgetConfig:Al,},success:function(Ar){console.log({msg:"/ajax/api/widget/saveNewWidgetInstance success!",result:Ar,});if(Am&&Ar.pagetemplateid){c(Ar.pagetemplateid);A.trigger(Ak)}if(Ar.widgetinstanceid){if(typeof Ap=="function"){Ap(Ar.widgetinstanceid)}}}})}function i(As){if(!As.data("is-tabbed-container")){return }var Aq=As.attr("data-widget-instance-id");if(!Aq){var Am=r(As),Al=function(Ay){console.log({msg:"added missing tabbed container widgetinstance",widgetinstanceid:Ay,parentContainerinstanceid:Am,});As.attr("data-widget-instance-id",Ay);return i(As)};return j(Am,As.attr("data-widget-id"),{},Al)}if(AU.isEmptyObject(AN)){return m(i,[As])}if(As.data("tabbed-container-initialized")){return }var Aw=As.find(".js-admin-widget-tab-panel-template"),Av=Aw.find(".js-admin-widget-list"),Ap=As.find(".js-admin-widget-tab-header-template"),At=As.find(".js-admin-widget-content"),An=At.find(".js-tab-headers"),Ax=An.find(".js-tab-add"),Ar,Ak;Aw.detach().removeClass("js-admin-widget-tab-panel-template");Ap.detach().removeClass("js-admin-widget-tab-header-template");At.tabs({beforeActivate:function(Ay,Az){if(AU(Az.newTab).hasClass("js-tab-add")){return false}},});Ar=At.tabs("widget");Av.css({minHeight:"60px",height:"auto",paddingBottom:"10px"});An.find(".js-tab-add").on("click",function(){var Ay=function(A0){var A2=AB(A0.config),A3=A2.tab_data,A4=A3.length||0,A1=A4,Az=A0.isusereditable.tab_data||false;openPromptDialog({title:vBulletin.phrase.get("enter_tab_title"),message:"",buttonLabel:{okLabel:vBulletin.phrase.get("ok"),cancelLabel:vBulletin.phrase.get("cancel")},onClickOK:function(A5){if(!A5){return false}Ao(A5,[],A1,A1,Az);A2.display_tabs[A1]="1";A2.tab_data=g(As);if(!AU.isEmptyObject(A2)){Z(As,A2)}}})};AL(As,Ay,true)});Ap.find(".js-edit-tab-button").on("click",function(){var A2=AU(this),Ay=A2.closest("li[aria-controls]"),Az=Ay.attr("aria-controls"),A1=Ar.find(".js-admin-widget-tab[id='"+Az+"']"),A0=A1&&A1.data("tab-title")||"";var A3=function(A4){var A5=AB(A4),A6=A5.tab_data;openPromptDialog({title:vBulletin.phrase.get("enter_tab_title"),message:"",initialValue:A0,buttonLabel:{okLabel:vBulletin.phrase.get("ok"),cancelLabel:vBulletin.phrase.get("cancel")},onClickOK:function(A7){Ay.find("span.js-tab-title").text(A7);A1.data("tab-title",A7);A5.tab_data=g(As);if(!AU.isEmptyObject(A5)){Z(As,A5)}}})};AL(As,A3);return false});Ap.find(".js-remove-tab-button").on("click",function(){var A2=AU(this),Az=A2.closest("li[aria-controls]"),A0=Az.attr("aria-controls"),A1=Ar.find(".js-admin-widget-tab[id='"+A0+"']");var Ay=function(A3){var A5=AB(A3.config),A6=A5.tab_data,A7=A6.length||0,A4=A1.data("tab-number");openConfirmDialog({title:vBulletin.phrase.get("remove_tab_q"),message:vBulletin.phrase.get("do_you_want_to_remove_tab",A1.data("tab-title")),iconType:"warning",onClickYes:function(){if(A5.default_tab==A4){A5.default_tab=0}if(!Array.isArray(A5.display_tabs)){A5.display_tabs=AU.map(A5.display_tabs,function(A9){return A9})}A5.display_tabs.splice(A4,1);var A8=[];A1.find(".canvas-widget").each(function(A9,BB){var BA=AU(this).data("widget-instance-id");if(BA){A8.push(BA)}});if(A8.length){AP(A8)}Az.remove();A1.remove();An.find("li:not('.js-tab-add')").each(function(A9,BD){var BA=AU(this),BC=BA.attr("aria-controls"),BB=Ar.find(".js-admin-widget-tab[id='"+BC+"']");if(BB.length){BB.data("tab-number",A9)}});Ar.tabs("refresh");A5.tab_data=g(As);if(!AU.isEmptyObject(A5)){Z(As,A5)}z();M();s=true}})};AL(As,Ay,true);return false});var Ao=function(BA,BB,Ay,A9,A0){if(typeof BA=="undefined"){BA="Untitled Tab"}if(typeof BB=="undefined"){BB=[]}if(typeof Ay=="undefined"){var BE=As.find(".js-admin-widget-tab");Ay=BE.length}var A1=BB.length,A5=Aw.clone().uniqueId().removeClass("h-hide").data("tab-number",Ay).data("tab-title",BA),A8=A5.find(".js-admin-widget-list"),Az=A5.attr("id"),A3=Ap.clone(true).removeClass("h-hide");A3.children("a.js-tab-header-link").attr("href","#"+Az);A3.find("span.js-tab-title").text(BA);for(var A4=0;A4<A1;A4++){var BC=BB[A4],A2=BC.widgetid||AN[BC.guid],BD=BC.widgetinstanceid||"",A6=AU('<div data-widget-id="'+A2+'" />');A6.attr("data-tab-number",Ay);A6.attr("data-widget-order",A4);A6.attr("data-widget-instance-id",BD);A6.append(AU('<img src="images/loader-box-blue.gif" /> '));A8.append(A6);if(A2){var A7=(function(BI,BG,BH,BF){return function(BO){if(!BH){var BJ=BI.adminconfig||{},BM=function(BR){BO.attr("data-widget-instance-id",BR);V(As)};j(Aq,BG,BJ,BM)}else{BO.attr("data-widget-instance-id",BH)}if(!A0){var BP=BO.find(".js-move-button"),BK=BO.find(".js-edit-button"),BQ=BO.find(".js-remove-button"),BL=BO.find(".js-edit-tab-button"),BN=BO.find(".js-remove-tab-button");BP.hide();BK.hide();BQ.hide();BL.hide();BN.hide();BO.addClass("js-widget-non-sortable")}BF.replaceWith(BO);BO.filter(":not(.container-widget)").find(".toggle-button").trigger("click",[true]);i(BO)}})(BC,A2,BD,A6);Ah(A6,A7)}}Ax.before(A3);Ar.append(A5);Ar.tabs("refresh");Ar.tabs("option","active",A9);A8.prepend('<div class="canvas-widget dummy-widget dummy-widget--no-fixed-height"><span>{0}</span></div>'.format(vBulletin.phrase.get("drag_and_drop_modules_below")))};var Au=function(A4){var A0=AB(A4.config),A8=A0.tab_data,A6=A8.length,A7=A0.default_tab,A1=A4.isusereditable.tab_data||false;for(var A3=0;A3<A6;A3++){Ao(A8[A3].title,A8[A3].widgets,A3,A7,A1)}if(A1){var Az,A2,Ay,A5;An.sortable({helper:"clone",opacity:1,axis:"x",items:"li:not('.js-tab-add')",cancel:".js-edit-tab-button, .js-remove-tab-button",start:function(){old_numidx_to_controls={};new_controls_to_numidx={};Ar.find(".js-admin-widget-tab").each(function(A9,BA){old_numidx_to_controls[A9]=AU(this).attr("id")})},stop:function(){An.find("li:not('.js-tab-add')").each(function(BA,BE){var BB=AU(this),BD=BB.attr("aria-controls"),BC=Ar.find(".js-admin-widget-tab[id='"+BD+"']");if(BC.length){BC.data("tab-number",BA);Ar.append(BC)}new_controls_to_numidx[BD]=BA});Ar.tabs("refresh");var A9=function(BA){A7=new_controls_to_numidx[old_numidx_to_controls[A7]];BA.default_tab=A7;var BD={};for(var BE in BA.display_tabs){var BB=new_controls_to_numidx[old_numidx_to_controls[BE]],BC=BA.display_tabs[BE];BD[BB]=BC}BA.display_tabs=BD;BA.tab_data=g(As);if(!AU.isEmptyObject(BA)){Z(As,BA)}};AL(As,A9)},})}else{Ax.hide()}};AL(As,Au,true);As.data("tabbed-container-initialized",true)}function I(Al,Am){var Ak=AU(".js-canvas-layout-container > .canvas-layout").attr("id");if(!vBulletin.sitebuilder.tempModuleHTMLCache){vBulletin.sitebuilder.tempModuleHTMLCache={};AU(".js-canvas-layout-container .canvas-widget").each(function(){var An=AU(this).data("widget-instance-id");vBulletin.sitebuilder.tempModuleHTMLCache["widgetinstance_"+An]=this.outerHTML})}AU(".js-canvas-layout-container").text("");vBulletin.AJAX({url:vBulletin.getAjaxBaseurl()+"/ajax/get-layouts-for-sitebuilder",data:{pagetemplateid:pageData.pagetemplateid,channelid:pageData.channelid},success:function(An){console.log("ajax/get-layouts-for-sitebuilder result:");console.dir(An);var Ao=AU(".js-canvas-layout-container");Ao.html(An.screenlayoutlist);if(An.widgets&&An.widgets.length>0){var Ap=AU("#"+Ak);AU.each(An.widgets,function(Aq,Ar){var As=Ap.find(".canvas-widget-list.section-"+Aq);AU.each(Ar,function(At,Av){As.append(Av.rendered_template);var Au=As.find(".canvas-widget").filter(function(){return AU(this).data("widget-instance-id")==Av.widgetinstanceid});if(typeof Av.subModules!="undefined"){AV(Au,Av.subModules)}i(Au)})})}if(vBulletin.inlinemod&&vBulletin.inlinemod.initModMenuHover){vBulletin.inlinemod.initModMenuHover()}if(typeof Am=="function"){Am()}},title_phrase:"sitebuilder",error_phrase:"unable_to_load_layouts"})}function L(Am,Ao){var Ak=Ao.enableButtons,An=AU(".js-top-menu-sitebuilder--list .js-top-menu-link");if(Ak){AU(".js-top-menu-user").removeClass("h-hide");An.removeClass("b-top-menu__item-link--selected b-top-menu__item-link--disabled")}else{var Al=AU(Ao.currentButton);An.removeClass("b-top-menu__item-link--selected").addClass("b-top-menu__item-link--disabled");Al.addClass("b-top-menu__item-link--selected");AU(".js-top-menu-user").addClass("h-hide")}}AU(document).on("vb-toggle-sitebuilder-menu",L);function Af(An){var Am=AU(An.target),Ak=Am.data("panel-name");if(Am.is(".b-top-menu__item-link--disabled")){this.blur();An.stopPropagation();return false}if(Am.is(".js-top-menu-tab--admincp")){return true}var Al="vb-sitebuilder-panel--"+Ak;AU(document).trigger(Al);return false}AU(document).on("click",".js-top-menu-sitebuilder--list .js-top-menu-link",Af);function AW(Am,Al){var Ak=AU(".js-top-menu-sitebuilder .js-top-menu-link");L(null,{enableButtons:!Al,currentButton:Am});AU(document.body).toggleClass("edit-mode "+Am.id,Al).toggleClass("view-mode",!Al);AU(".js-top-menu-user").toggleClass("h-hide",Al)}function e(){if(!AU(this).hasClass("selected")&&!AU(document.body).hasClass("edit-mode")){AW(this,true)}return false}vBulletin.sitebuilder.activateSB=e;function D(){AW(this,false);return false}function Y(Am,Al){var Ak=AU("<div />").append(Am.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,'<span class="axd-placeholder">{0}'.format(vBulletin.phrase.get("x_will_show_up_here_when_saved",Al))).replace(/<vb\:/g,"&lt;vb:").replace(/<\/vb\:/g,"&lt;/vb:"));Ak.find("span.axd-placeholder").not(":first").remove();Ak.find("iframe").remove();return Ak.html()}function AS(){var Au=null;var An=null;var Ao=null;var Ap="";var Aw="";var Az="";var Ay="";var A0=function(A1){if(!A1){return false}if(A1.match(/^https?:\/\//i)){return A1}if(A1.substr(0,1)=="/"){return pageData.baseurl+A1}return pageData.baseurl+"/"+A1};var At=function(A7,A3,A4,A6,A1,A2){A1=A1||[];console.log("createNavbarItem... Name: "+A3+" Url: "+A4+" NewWindow: "+A6+" UserGroups: "+A1+" itemAttr: "+A2);A3=JShtmlEncode(A3);var A5=AU("<li />").append("<label>{0}</label>".format(A3)).append(AU("<div />").addClass("nav-item-controls h-right").append('<i>|</i><span class="navbar-item-delete" title="{0}"></span>'.format(vBulletin.phrase.get("delete"))).append('<i>|</i><span class="navbar-item-edit" title="{0}"></span>'.format(vBulletin.phrase.get("edit"))).append('<i>|</i><span class="navbar-item-opensubnav" title="{0}"></span>'.format(vBulletin.phrase.get("expand")))).data({"item-phrase":A7,"item-name":A3,"item-url":A4,"item-newwindow":A6,"item-usergroups":A1,"item-attr":A2});return A5};var Ak=function(A1){return A1.prevAll("li").size()};var Al=function(){var A2=(Ay=="navbar"),A1=A2?AU("#channel-tabbar ul"):AU("#footer-tabbar ul.nav-list"),A3=A2?AU("#channel-subtabbar ul"):AU();A1.html("");A3.html("");var A4=function(BA,A8,A5){var A7=A8.data("item-newwindow")?' target="_blank"':"",A9=A8.hasClass("selected")&&A5?' class="current"':"",A6=AU("<li{0}><a {1}>{2}</a></li>".format(A9,A7,A8.data("item-name")));A6.find("a").prop("href",A0(A8.data("item-url")));BA.append(A6)};AU("#edit-navbar .navbar-ui-wrapper ul li").each(function(){var A5=AU(this);A4(A1,A5,A2);if(A5.hasClass("selected")){AU(A5.data("subnav-element")).find("li").each(function(){A4(A3,AU(this),true)})}})};var Ax=function(A7,A9,A2,A3,A5,A8,A4){var A1=At(A7,A9,A2,A3,A5,A4);console.log("insertNavbarItem... Name: "+A1.data("item-name")+" Url: "+A1.data("item-url")+" NewWindow: "+A1.data("item-newwindow")+" UserGroups: "+A1.data("item-usergroups")+" itemAttr: "+A1.data("item-attr"));A1.appendTo(An);var A6=AU("<ul />").addClass("sub-navbar-list navbar-list sortable");AU(A8).each(function(){var BG=this.phrase?this.phrase:"",BB=this.title?this.title:"",BE=this.url?this.url:"",BF=this.newWindow?this.newWindow:false,BA=this.usergroups?this.usergroups:[],BD=this.attr?this.attr:"";var BC=At(BG,BB,BE,BF,BA,BD);BC.appendTo(A6)});(function(){var BA=null;A6.sortable({start:function(BB,BC){BC.placeholder.html(vBulletin.phrase.get("drop_page_here")).height(BC.item.height()-2)},stop:function(BB,BC){Al()},receive:function(BB,BC){var BD=BC.item.data("subnav-element")||AU();if(BD.is(":visible")){BC.sender.sortable("cancel");vBulletin.warning("move_not_allowed","moving_main_nav_to_own_sub_nav_error")}else{if(BD.find("li").length>0){BC.sender.sortable("cancel");vBulletin.warning("move_not_allowed","moving_main_nav_with_sub_nav_error")}}},connectWith:".sortable",placeholder:"sortable-highlight",forcePlaceholderSize:true}).disableSelection()})();A6.hide();A6.appendTo("#navbar-ui-container .subnavbar-list-container");A1.data("subnav-element",A6);Al()};var Ar=function(A2,A4,A5,A6,A1,A3){$newItem=At(A2.data("item-phrase"),A4,A5,A6,A1,A3);console.log("updateNavbarItem... Name: "+$newItem.data("item-name")+" Url: "+$newItem.data("item-url")+" NewWindow: "+$newItem.data("item-newwindow")+" itemAttr: "+$newItem.data("item-attr"));if(A2.data("subnav-element")){$newItem.data("subnav-element",A2.data("subnav-element"))}if(A2.hasClass("selected")){$newItem.addClass("selected")}A2.replaceWith($newItem);Al()};var As=function(A1){Ay=A1;if(Ay=="navbar"){Ap=AU("#channel-tabbar ul").html();Aw=AU("#channel-subtabbar ul").html();Az=AU("#channel-tabbar ul li.current a").attr("href");AU("#channel-subtabbar.h-hide").toggleClass("h-hide default-hide")}else{Ap=AU("#footer-tabbar ul.nav-list").html();Az=AU("#footer-tabbar ul.nav-list li.current a").attr("href")}AU("#admin-navbar-strip-gutter").removeClass().addClass("navbar-"+Ay);AU("#header").add("#header-axd").hide();AU("#edit-navbar #navbar-ui-container .navbar-ui-wrapper").remove();AU("#edit-navbar #navbar-ui-container .subnavbar-ui-wrapper").remove();AU("#edit-navbar .panel-header-text").hide();AU("#edit-navbar #panel-header-"+Ay).show();AU("#edit-navbar").slideDown("slow",function(){window.vBulletin.loadingIndicator.show();AU("body").css("cursor","wait");var A2=(Ay=="navbar")?"loadHeaderNavbar":"loadFooterNavbar";AU.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/site/"+A2,data:({siteId:1,edit:1}),type:"POST",dataType:"json",complete:function(){window.vBulletin.loadingIndicator.hide();AU("body").css("cursor","auto")},success:function(A3){console.log(A2+" successful! result:"+JSON.stringify(A3));var A6=AU("<ul />").addClass("main-navbar-list navbar-list sortable "+Ay);var A5=AU("<div />").addClass("new-nav-item main-nav").html(vBulletin.phrase.get("new_navigation_item"));var A4=AU("<h4 />").text(vBulletin.phrase.get("main_navigation_bar"));AU("<div />").addClass("navbar-ui-wrapper").append(A4).append(A6).append(A5).appendTo("#navbar-ui-container");var A9=null;A6.sortable({start:function(BB,BC){BC.placeholder.html(vBulletin.phrase.get("drop_page_here")).height(BC.item.height()-2)},stop:function(BB,BC){Al()},connectWith:".sortable",placeholder:"sortable-highlight",forcePlaceholderSize:true}).disableSelection();An=A6;var BA=AU("<div />").addClass("subnavbar-list-container");var A8=AU("<div />").addClass("new-nav-item sub-nav").html(vBulletin.phrase.get("new_subnavigation_item"));var A7=AU("<h4 />").text(vBulletin.phrase.get("sub_navigation_bar"));AU("<div />").addClass("subnavbar-ui-wrapper").append(A7).append(BA).append(A8).appendTo("#navbar-ui-container").hide();if(A3){console.log("result:",A3);AU(A3).each(function(){var BH=this.phrase?this.phrase:"",BC=this.title?this.title:"",BF=this.url?this.url:"",BG=this.newWindow?true:false,BB=this.usergroups?this.usergroups:[],BE=this.subnav?this.subnav:[],BD=this.attr?this.attr:"";Ax(BH,BC,BF,BG,BB,BE,BD)});console.log("Done adding items")}AU("#edit-navbar .navbar-ui-wrapper ul li").first().find(".navbar-item-opensubnav").filter(":visible").click()},error:function(A5,A4,A3){console.log(A2+" failed! error:"+A3);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_retrieving_navigation_bar_configuration"),iconType:"error",onAfterClose:function(){AU("#config-dialog").dialog("close")}});AU("#config-dialog .loader").hide()}})})};AU(document).on("vb-sitebuilder-panel--navbar",function(){var A1=AU(".js-top-menu-tab--navbar").get(0);if(AU("#edit-navbar").is(":hidden")){vBulletin.assertUserHasAdminPermission("canusesitebuilder",A1,function(){e.apply(A1);As("navbar")})}return false});AU(document).on("vb-sitebuilder-panel--footer",function(){var A1=AU(".js-top-menu-tab--footer").get(0);if(AU("#edit-navbar").is(":hidden")){vBulletin.assertUserHasAdminPermission("canusesitebuilder",A1,function(){e.apply(A1);As("footer")})}return false});var Aq=function(A1){AU("#navbar-edit-item").dialog({autoOpen:true,modal:true,resizable:false,closeOnEscape:false,showCloseButton:false,width:400,dialogClass:"dialog-container navbar-item-dialog-container",open:function(){AU("#navbar-edit-name").focus()}}).dialog("option","title",A1||vBulletin.phrase.get("edit_navigation_item")).dialog("open")};AU("#edit-navbar").on("click",".new-nav-item",function(){Au=null;if(AU(this).closest(".navbar-ui-wrapper").size()>0){An=AU(this).closest(".navbar-ui-wrapper").find("ul")}else{An=AU(this).closest(".subnavbar-ui-wrapper").find("ul").filter(":visible")}AU("#navbar-edit-name").val("");AU("#navbar-edit-url").val("");AU("#navbar-edit-attr").val("");AU("#navbar-edit-newwindow").prop("checked",false);Aq(AU(this).html());return false});AU(document).on("click","#navbar-edit-save",function(){if(AU("#navbar-edit-name").val()==""){vBulletin.warning("edit_navigation_item","input_navigation_item_name",function(){AU("#navbar-edit-name").focus()})}else{if(AU("#navbar-edit-url").val()==""){vBulletin.warning("edit_navigation_item","input_target_url",function(){AU("#navbar-edit-url").focus()})}else{console.log("Saving new/edited navbar item");if(!Au){Ax("",AU("#navbar-edit-name").val(),AU("#navbar-edit-url").val(),AU("#navbar-edit-newwindow").prop("checked"),AU("#navbar-edit-item").data("edit-usergroups"),[],AU("#navbar-edit-attr").val())}else{Ar(Au,AU("#navbar-edit-name").val(),AU("#navbar-edit-url").val(),AU("#navbar-edit-newwindow").prop("checked"),AU("#navbar-edit-item").data("edit-usergroups"),AU("#navbar-edit-attr").val())}Au=null;An=null;AU("#navbar-edit-item").dialog("close");console.log("Done saving new/edited navbar item")}}return false});AU(document).on("click","#navbar-edit-cancel",function(){AU("#navbar-edit-item").dialog("close");return false});var Am=false;AU(document).on("click","#navbar-edit-usergroups",function(){var A2=function(){var A6=AU("#navbar-edit-usergroups-dialog .select_all"),A3=AU("#navbar-edit-usergroups-dialog .navbar-usergroup-checkbox");A3.prop("checked",false);var A4=function(){var A7=(A3.filter(":checked").length==A3.length&&A3.eq(0).is(":checked"));A6.prop("checked",A7)};A3.off("change").on("change",A4);A6.off("change").on("change",function(){A3.prop("checked",AU(this).prop("checked"))});if(!Au){return false}console.log("Prefilling checked usergroups");console.log(Au.data("item-name"));console.log(Au.data("item-url"));console.log(Au.data("item-usergroups"));if(Au.data("item-usergroups-temp")){var A5=Au.data("item-usergroups-temp")}else{var A5=Au.data("item-usergroups")}console.log(A5);AU.each(A5,function(A7,A8){AU("#navbar-usergroup-checkbox-"+A8).prop("checked",true)});A4()};var A1=function(){var A3=[];AU("#navbar-edit-usergroups-dialog .dialog-body input[type=checkbox]").each(function(){if(AU(this).prop("checked")){A3.push(AU(this).val())}});AU("#navbar-edit-item").data("edit-usergroups",A3);if(Au){Au.data("item-usergroups-temp",A3)}console.log("Saving checked usergroups")};if(!Am){AU("#navbar-edit-usergroups-dialog").dialog({title:vBulletin.phrase.get("user_group_settings"),autoOpen:true,modal:true,resizable:false,closeOnEscape:false,showCloseButton:false,width:500,dialogClass:"dialog-container pagemap-dialog-container input-dialog",create:function(){AU("#navbar-edit-usergroups-dialog .cancel-button").on("click",function(){AU("#navbar-edit-usergroups-dialog").dialog("close")});AU("#navbar-edit-usergroups-dialog .save-button").on("click",function(){A1();AU("#navbar-edit-usergroups-dialog").dialog("close")});vBulletin.AJAX({call:"/ajax/api/usergroup/fetchUsergroupList",complete:function(){AU("body").css("cursor","auto")},success:function(A3){var A4=[];AU(A3).each(function(){A4.push('<div class="blockrow"><label><input type="checkbox" class="navbar-usergroup-checkbox" id="navbar-usergroup-checkbox-{0}" value="{0}"><span>{1}</span></label></div>'.format(this.usergroupid,this.title))});AU("#navbar-edit-usergroups-dialog .dialog-body").html(A4.join(""));AU("#navbar-edit-usergroups-dialog").dialog("option","position",{of:window});console.log("Done adding usergroups");A2()},error_phrase:"error_retrieving_list_user_groups",after_error:function(){AU("#navbar-edit-usergroups-dialog").dialog("close")}})},close:function(){},open:function(){A2()}});Am=true}else{AU("#navbar-edit-usergroups-dialog").dialog("open")}return false});AU("#edit-navbar").on("click",".navbar-item-delete",function(){AU(this).closest("li").remove();Al();return false});AU("#edit-navbar").on("click",".navbar-item-edit",function(){var A1=AU(this).closest("li");console.log("Click to edit item... Name: "+A1.data("item-name")+" Url: "+A1.data("item-url")+" NewWindow: "+A1.data("item-newwindow")+" UserGroups: "+A1.data("item-usergroups"));Au=A1;An=A1.closest("ul");Au.data("item-usergroups-temp",null);AU("#navbar-edit-name").val(A1.data("item-name"));AU("#navbar-edit-url").val(A1.data("item-url"));AU("#navbar-edit-attr").val(A1.data("item-attr"));AU("#navbar-edit-newwindow").prop("checked",A1.data("item-newwindow"));Aq(AU(this).html());return false});AU("#edit-navbar").on("click",".navbar-item-opensubnav",function(){var A1=AU(this).closest("li");console.log("Click to open item subnav ... Name: "+A1.data("item-name")+" Url: "+A1.data("item-url")+" NewWindow: "+A1.data("item-newwindow")+" UserGroups: "+A1.data("item-usergroups"));AU("#edit-navbar li").removeClass("h-disabled selected");A1.addClass("selected");AU("#edit-navbar .subnavbar-ui-wrapper ul").hide();AU(A1.data("subnav-element")).show();AU("#edit-navbar .subnavbar-ui-wrapper").show();Al();return false});AU(document).on("click",".navbar-navbar #admin-navbar-strip .lnkExitWithoutSaving, .navbar-footer #admin-navbar-strip .lnkExitWithoutSaving",function(){AU("#edit-navbar").slideUp();AU("#header").add("#header-axd").show();if(Ay=="navbar"){AU("#channel-tabbar ul").html(Ap);AU("#channel-subtabbar ul").html(Aw).parent(".default-hide").toggleClass("h-hide default-hide")}else{AU("#footer-tabbar ul.nav-list").html(Ap)}});var Av=function(){var A1=[];AU("#edit-navbar .navbar-ui-wrapper ul li").each(function(){var A4=AU(this);var A3=[];A4.data("subnav-element").find("li").each(function(){$subLi=AU(this);A3.push({phrase:$subLi.data("item-phrase"),title:$subLi.data("item-name"),url:$subLi.data("item-url"),newWindow:$subLi.data("item-newwindow"),usergroups:$subLi.data("item-usergroups"),attr:$subLi.data("item-attr")})});A1.push({phrase:A4.data("item-phrase"),title:A4.data("item-name"),url:A4.data("item-url"),newWindow:A4.data("item-newwindow"),usergroups:A4.data("item-usergroups"),subnav:A3,attr:A4.data("item-attr")})});var A2=(Ay=="navbar")?"saveHeaderNavbar":"saveFooterNavbar";AU.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/site/"+A2,data:({siteId:1,data:A1}),type:"POST",dataType:"json",complete:function(){AU("body").css("cursor","auto")},success:function(A4){if(A4.errors){console.log(A2+" failed! error:"+JSON.stringify(A4));openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_saving_navigation_bar_configuration"),iconType:"error"});return }console.log(A2+" successful! result:"+JSON.stringify(A4));AU("#edit-navbar").slideUp();AU("#header").add("#header-axd").show();AU("#admin-navbar-strip-gutter").addClass("h-hide");AU(document.body).removeClass("edit-mode lnkEditPage lnkNewPage lnkHeader lnkNavBar lnkFooter").addClass("view-mode");L(null,{enableButtons:true,currentButton:null});if(Ay=="navbar"){var A3=false;AU("#edit-navbar .navbar-ui-wrapper ul li").each(function(){var A5=AU(this);if(A0(A5.data("item-url"))==Az){A3=true;AU("#edit-navbar .navbar-ui-wrapper ul li").removeClass("selected");A5.addClass("selected");return false}});if(A3){Al()}else{AU("#channel-tabbar ul li").removeClass("current");AU("#channel-subtabbar ul").html("")}}else{AU("#footer-tabbar ul.nav-list li").removeClass("current");AU("#footer-tabbar ul.nav-list li").filter(function(){var A5=AU(this).find("a").attr("href");return(A5==Az)}).addClass("current")}},error:function(A5,A4,A3){console.log(A2+" failed! error:"+A3);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_saving_navigation_bar_configuration"),iconType:"error",onAfterClose:function(){AU("#config-dialog").dialog("close")}});AU("#config-dialog .loader").hide()}})};AU(document).on("click",".navbar-navbar #admin-navbar-strip .lnkSaveChanges",function(){Av()});AU(document).on("click",".navbar-footer #admin-navbar-strip .lnkSaveChanges",function(){Av()})}function AK(){bindFormReset("#edit-page-dropdown form").trigger("reset",function(){AU("#save-content .template-name").addClass("h-hide");AU("input[type=hidden]",this).each(function(){this.value=this.defaultValue})});AU(".js-top-menu-sitebuilder--list .js-top-menu-link").removeClass("b-top-menu__item-link--disabled");AU(document).on("click","#sitebuilder-wrapper .lnkExitWithoutSaving",function(){if(AU(this).closest("#edit-page-dropdown").length==0){L(null,{enableButtons:true,currentButton:null})}});AU(document).on("vb-sitebuilder-panel--channels",function(){var Ar=AU(".js-top-menu-tab--channels").get(0);vBulletin.assertUserHasAdminPermission("canusesitebuilder",Ar,function(){e.apply(Ar);X(false);AU(".edit-mode .canvas-widget-list .canvas-widget").addClass("shadow");AU("#header, #header-axd, #save-content").hide();AU("#manage-page").show();AU("#edit-page-dropdown .lnkDeletePage").removeClass("h-hide");AU("#manage-page-dropdown").removeClass("h-hide").slideDown("slow",AD)});return false});function Ap(){var Ar=AU(".js-sbpanel-pagelist-wrapper");Ar.find(".tab-item a").on("click",function(As){As.preventDefault()});Ar.tabs()}function Ao(){var Au=AU(".js-sbpanel-pagelist-wrapper"),As=Au.find(".js-delayed-template-render-insert-here"),At=Au.find(".js-loading-placeholder"),Ar={};Au.find(".js-simple-pagination-wrapper").each(function(){var Av=AU(this);Ar[Av.attr("id")]=Av.find(".js-pagenum").val()||0});Au.tabs("disable");As.html("");At.removeClass("h-hide");vBulletin.AJAX({call:"/ajax/render/admin_sbpanel_pagelist_content_wrapper",success:function(Av){As.html(Av);Au.tabs("refresh");Au.tabs("enable");Au.find(".js-simple-pagination-wrapper").each(function(){var Aw=AU(this);An(Aw,Ar[Aw.attr("id")]);Ak(Aw);Aq(Aw)})},error_phrase:"error_fetching_dialog",complete:function(){At.addClass("h-hide")}})}AU(document).on("vb-sitebuilder-panel--pages",function(){var Ar=AU(".js-top-menu-tab--pages").get(0),As=AU(".js-sbpanel-pagelist-wrapper");if(!As.data("panel-initialized")){As.data("tabspanel-initialized",true);Ap()}vBulletin.assertUserHasAdminPermission("canusesitebuilder",Ar,function(){if(As.hasClass("h-hide")){e.apply(Ar);As.removeClass("h-hide").slideDown("slow");Ao()}else{D.apply(Ar);As.slideUp("fast",function(){As.addClass("h-hide")})}});return false});AU(document).on("click",".js-sbpanel-pagelist-wrapper .js-button--close-panel",function(){var Ar=AU("#lnkPageList")[0],As=AU(".js-sbpanel-pagelist-wrapper");if(!As.hasClass("h-hide")){D.apply(Ar);As.slideUp("fast",function(){As.addClass("h-hide")})}});function Ak(As){var Ar=As.data("select-all-checkboxes-initialized")||false;if(Ar){console.log({msg:"Skipping checkbox init because it's already done.",$wrapper:As,});return }else{As.data("select-all-checkboxes-initialized",true)}As.find(".js-checkbox--checkall").each(function(){var At=AU(this),Av=At.data("group-id"),Ax=As.find(".js-checkbox[data-group-id='"+Av+"']"),Aw=Ax.length,Au=Ax;At.on("change",function(Ay){var Az=AU(this).prop("checked");At.prop("indeterminate",false);if(Az){Ax.prop("checked",true)}else{Ax.prop("checked",false)}});Ax.on("change",function(Ay){var A0=AU(this).prop("checked"),Az=Ax.filter(":checked").length;if(Aw>Az){if(At.prop("checked")&&Az>0){At.prop("indeterminate",true)}At.prop("checked",false)}else{At.prop("indeterminate",false);At.prop("checked",true)}})})}function Aq(As){var Ar=As.data("actions-initialized")||false;if(Ar){console.log({msg:"Skipping actions init because it's already done.",$wrapper:As,});return }else{As.data("actions-initialized",true)}As.find(".js-delete-orphaned-pagetemplates").on("click",function(At){var Ax=AU(this),Av=Ax.data("group-id"),Au=As.find(".js-checkbox[data-group-id='"+Av+"']:checked"),Aw={};Au.each(function(){Aw[this.name]=AU(this).val()});if(Au.length<1){vBulletin.error("error","delete_orphaned_pagetemplates_please_select_one")}else{openConfirmDialog({title:vBulletin.phrase.get("delete"),message:vBulletin.phrase.get("delete_orphaned_pagetemplates_prompt_x",Au.length),iconType:"warning",onClickYes:function(){vBulletin.AJAX({call:"/ajax/api/page/deleteOrphanedPagetemplates",data:Au.serializeArray(),success:function(Ay){console.log({msg:"/ajax/api/widget/deleteOrphanedPagetemplates success!",result:Ay,});Ao()}})}})}})}function An(Aw,Ax){var Au=Aw.data("pagination-initialized")||false;if(Au){console.log({msg:"Skipping pagination init because it's already done.",$wrapper:Aw,});return }else{Aw.data("pagination-initialized",true)}var Ar=Aw.find(".js-pagenav-goprev");var Ay=Aw.find(".js-pagenav-gopost");var As=Aw.find(".js-pagenum");var Ax=(Ax&&parseInt(Ax,10))||parseInt(As.val(),10);var Az=Aw.find(".js-paginated-page");var Av={};var A0=0;Az.each(function(){A0++;Av[A0]=AU(this)});As.on("blur keyup",function(A2){if(A2.type=="blur"||A2.keyCode=="13"){var A1=parseInt(As.val(),10);At(A1)}});Ar.on("click",function(A2){var A1=parseInt(As.val(),10);A1--;At(A1)});Ay.on("click",function(A2){var A1=parseInt(As.val(),10);A1++;At(A1)});function At(A1){if(A1<1){A1=1}if(A1>A0){A1=A0}Az.addClass("h-hide");if(Av[A1]){Av[A1].removeClass("h-hide")}As.val(A1)}At(Ax)}AU(document).on("vb-sitebuilder-panel--editpage",function(){var Ar=AU(".js-top-menu-tab--editpage").get(0);if(AU("#edit-page-dropdown-gutter").is(":hidden")){vBulletin.assertUserHasAdminPermission("canusesitebuilder",Ar,function(){function As(){t=false;At();M();X(false,".container-widget");AU(".edit-mode .canvas-widget-list .canvas-widget").addClass("shadow");f.tabs("option","active",0);AU("#header, #header-axd, #save-content").hide();AU("#edit-content").show();AU("#edit-page-dropdown .lnkSaveChanges .label").text(vBulletin.phrase.get("save_page"));AU("#edit-page-dropdown .lnkDeletePage").removeClass("h-hide");AU("#edit-page-dropdown-gutter").removeClass("h-hide").slideDown("slow",Q);AU(".canvas-widget.axd-widget .widget-content").each(function(){AU(this).html(Y(AU(this).html(),vBulletin.phrase.get("ad")))})}function At(){var Au=[];AU(".hidden-widget-placeholder").each(function(){Au.push(AU(this).attr("data-widget-instance-id"))});if(Au.length<1){return }AU.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/fetch-hidden-modules",data:({modules:Au}),type:"POST",dataType:"json",complete:function(){console.log("fetch-hidden-modules complete.");As()},success:function(Av){console.log("fetch-hidden-modules successful! result:"+JSON.stringify(Av));if(AU.isArray(Av)){if(Av.length>0){AU.each(Av,function(Aw,Ay){var Ax=AU(Ay.template).addClass("hidden-widget");AU('.hidden-widget-placeholder[data-widget-instance-id="'+Ay.widgetinstanceid+'"]').replaceWith(Ax)})}}else{openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("invalid_server_response_please_try_again"),iconType:"error"})}},error:function(Ax,Aw,Av){console.log("fetch-hidden-modules failed! error:"+Av);window.vBulletin.loadingIndicator.hide();openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_retrieving_modules",Ax.status),iconType:"error"})}})}e.apply(Ar);I(false,As)})}return false});AU(document).on("vb-sitebuilder-panel--newpage",function(){var Ar=AU(".js-top-menu-tab--newpage").get(0);if(AU("#edit-page-dropdown-gutter").is(":hidden")){vBulletin.assertUserHasAdminPermission("canusesitebuilder",Ar,function(){function As(){t=true;AU(".canvas-widget-list").empty();f.tabs("option","active",0);AU("#change-layout .layout-border.selected").removeClass("selected");AU("#layout-wide-narrow").prev().trigger("click");s=false;AU("#header, #header-axd, #save-content").hide();AU("#edit-content").show();AU("#edit-page-dropdown .lnkSaveChanges .label").text(vBulletin.phrase.get("save_new_page"));AU("#edit-page-dropdown .lnkDeletePage").addClass("h-hide");AU("#edit-page-dropdown-gutter").removeClass("h-hide").slideDown("slow",Q)}e.apply(Ar);I(true,As)})}return false});var Am=false;AU(document).on("vb-sitebuilder-panel--header",function(){var Ar=AU(".js-top-menu-tab--header").get(0);if(AU("#admin-navbar-strip-gutter").is(":hidden")){vBulletin.assertUserHasAdminPermission("canusesitebuilder",Ar,function(){e.apply(Ar);Am=false;AU("#admin-navbar-strip-gutter").addClass("navbar-header").removeClass("h-hide").find(".prompt-text").text(vBulletin.phrase.get("select_edit_link_header"));var As=AU("#header"),At=AU(".header-cell",As);$siteLogoEditStrip=AU("> .admin-only",At).addClass("h-hide-imp"),w=At.outerWidth();AU(".disable-overlay",As).width(As.innerWidth()-w).height(As.innerHeight()).show();$siteLogoEditStrip.width(w-(parseInt($siteLogoEditStrip.css("padding-left"),10)+parseInt($siteLogoEditStrip.css("padding-right"),10))).removeClass("h-hide-imp");AU(document).on("focus click mousedown",".edit-mode.lnkHeader #header .site-logo > a",function(Au){this.blur();Au.stopPropagation();return false})})}return false});AS();AU(".js-top-menu-sitebuilder").removeClass("h-hide");AU(document).on("click","#admin-navbar-strip .lnkSaveChanges",function(){});AU(document).on("click",".lnkHeader #admin-navbar-strip .lnkSaveChanges",function(){AU("body").css("cursor","wait");if(Number(AU("#header .site-logo img").attr("data-fileid"))>0){var Ar=Am?function(){location.reload(true)}:null;AH(Ar)}else{if(Am){location.reload(true)}else{AU("body").css("cursor","auto");AU("#admin-navbar-strip-gutter").addClass("h-hide").find(".prompt-text").text("");AU(document.body).removeClass("edit-mode lnkHeader").addClass("view-mode");AU("#header .disable-overlay").hide();L(null,{enableButtons:true,currentButton:null})}}});AU(document).on("click",".lnkHeader #admin-navbar-strip .lnkExitWithoutSaving",function(As){if(Am){As.stopImmediatePropagation();location.reload(true);return false}else{var Ar=AU("#header .site-logo img");if(Ar.attr("src")!=Ar.attr("data-orig-src")){Ar.attr("src",Ar.attr("data-orig-src")).removeAttr("data-fileid")}AU("#admin-navbar-strip-gutter").find(".prompt-text").text("");AU("#header .disable-overlay").hide();L(null,{enableButtons:true,currentButton:null})}});AU(document).on("click","#admin-navbar-strip .lnkExitWithoutSaving",function(){AU("#admin-navbar-strip-gutter").addClass("h-hide");AU(document.body).removeClass("edit-mode lnkEditPage lnkNewPage lnkHeader lnkNavBar lnkFooter").addClass("view-mode");AU("#header").add("#header-axd").show();AU("#edit-navbar").hide();L(null,{enableButtons:true,currentButton:null})});AU("#header-axd .axdnum").change(function(){var Ar=AU(this),As=parseInt(Ar.val());window.vBulletin.loadingIndicator.show();vBulletin.AJAX({call:"/ajax/api/ad/saveNumberOfHeaderAds",data:{number:As},success:function(At){if(As==1){AU("#header-axd").removeClass("axdnum_2").addClass("axdnum_1")}else{AU("#header-axd").removeClass("axdnum_1").addClass("axdnum_2")}},complete:function(){window.vBulletin.loadingIndicator.hide()}})});AU(document).off("click",".axd-edit-button").on("click",".axd-edit-button",function(){var As=AU(this).attr("data-location"),Ax=AU(this).closest(".axd-container");if(Ax.length==0){Ax=AU('.axd-container[data-widget-instance-id="'+As+'"]')}Aw();function Aw(Ay){Ay=Ay||false;AU("body").css("cursor","wait");vBulletin.AJAX({call:"/ajax/api/ad/listAdsByLocation",data:{adlocation:As},cache:false,success:At,emptyResponse:function(){if(!Ay){Au({adlocation:As})}else{At([])}},complete:function(){AU("body").css("cursor","default")}})}function At(Ay){if(typeof h.axd_list_dialog=="undefined"){vBulletin.AJAX({call:"/ajax/render/dialog_axd_list",success:function(Az){h.axd_list_dialog=Az;AU("body").append(Az);At(Ay)},error_phrase:"error_fetching_dialog"});return }AU("#axd-list-dialog").dialog({title:vBulletin.phrase.get("manage_ads"),autoOpen:true,modal:true,resizable:false,closeOnEscape:false,showCloseButton:false,width:600,dialogClass:"dialog-container ad-list-dialog-container input-dialog",open:function(){var Az=AU(this),A1=[];var A2=function(){Az.dialog("close");Az.dialog("destroy")};for(var A0 in Ay){A1.push([Ay[A0].title,Ay[A0].active,Ay[A0].displayorder,Ay[A0].adid])}AU(".title",Az).text(vBulletin.phrase.get("ad_list_description"));AU(".axdtable",Az).dataTable({bPaginate:false,bLengthChange:false,bInfo:false,bAutoWidth:false,bDestroy:true,aaSorting:[[2,"asc"]],aoColumns:[{sTitle:vBulletin.phrase.get("title")+"<span></span>",sClass:"axdtable-title axd-cell"},{sTitle:vBulletin.phrase.get("active"),sClass:"axdtable-active axd-cell",bSortable:false,bSearchable:false,fnRender:function(A4,A3){return'<input type="checkbox" class="isactive" data-id="{0}"{1} />'.format(A4.aData[3],((A3=="1")?' checked="checked"':""))}},{sTitle:vBulletin.phrase.get("display_order")+"<span></span>",sClass:"axdtable-display-order axd-cell",bSearchable:false,bUseRendered:false,fnRender:function(A4,A3){return'<input type="text" class="displayorder textbox" value="{0}" data-id="{1}" />'.format(A4.aData[2],A4.aData[3])}},{sTitle:vBulletin.phrase.get("action"),sClass:"axdtable-action axd-cell",bSearchable:false,bSortable:false,bUseRendered:false,fnRender:function(A4,A3){return'<a href="#" class="editlink" data-id="{0}" title="{1}"><span></span></a> <a href="#" class="deletelink" data-id="{0}" title="{2}"><span></span></a>'.format(A4.aData[3],vBulletin.phrase.get("edit"),vBulletin.phrase.get("delete"))}}],aaData:A1});AU(".dataTables_filter input[type=text]",Az).addClass("axdfilter textbox").on("keyup",function(){AU(this).next()[this.value!=""?"removeClass":"addClass"]("h-hide")}).after('<button type="button" class="axdSearchBtn b-button b-button--secondary b-button--sitebuilder h-hide">{0}</button>'.format(vBulletin.phrase.get("reset")));AU(".axdSearchBtn",Az).on("click",function(){AU(this).addClass("h-hide").prev().val("").trigger("keyup")});AU(".axdtable .editlink",Az).off("click").on("click",function(){var A3=AU(this).attr("data-id");A2();Au(Ay[A3]);return false});AU(".axdtable .deletelink",Az).off("click").on("click",function(){var A3=AU(this).attr("data-id"),A4=AU(this).closest("tr").find(".isactive").prop("checked");A2();openConfirmDialog({title:vBulletin.phrase.get("confirm_deletion_x",Ay[A3].title),message:vBulletin.phrase.get("are_you_sure_want_to_delete_ad_x",Ay[A3].title,"adid",A3),iconType:"warning",onClickYes:function(){AU("body").css("cursor","wait");vBulletin.AJAX({call:"/ajax/api/ad/delete",data:{adid:A3},success:function(A5){Aw(true);if(A4){Am=true}}})},onClickNo:function(){Aw()}});return false});AU(".axdlist",Az).show();AU(".btnAddAxd",Az).off("click").on("click",function(){A2();Au({adlocation:As});return false});AU(".btnCancelAxd",Az).off("click").on("click",function(){A2()});AU(".btnSaveAxd",Az).off("click").on("click",function(){if(AU(".isactive",Az).length==0){A2();return false}AU("body").css("cursor","wait");var A3={},A4=[];AU(".isactive",Az).each(function(){var A5=AU(this).attr("data-id");A3[A5]={};A3[A5]["displayorder"]=AU('.displayorder[data-id="'+A5+'"]',Az).val();if(AU(this).is(":checked")){A3[A5]["active"]=1;var A6=A3[A5];A6.snippet=Ay[A5].snippet;A6.title=Ay[A5].title;A4.push(A6)}else{A3[A5]["active"]=0}});vBulletin.AJAX({call:"/ajax/api/ad/quickSave",data:{data:A3},success:function(A5){var A6=AU(".axd_"+As,Ax);if(A6.length==0){A6=AU(".widget-content",Ax)}if(A4.length>0){A4.sort(function(BA,A9){return BA.displayorder-A9.displayorder});var A8="",A7="";AU.map(A4,function(BA,A9){if(BA.snippet){A7+=Y(BA.snippet,BA.title);A8+=BA.snippet}});A6.html(A7);Am=Av(A8)}else{A6.html("")}A6.show();A2();AU("html,body").animate({scrollTop:0},"slow")},complete:function(){AU("body").css("cursor","default")}})})}})}function Au(Ay){vBulletin.AJAX({call:"/ajax/render/dialog_axd_config",success:function(Az){h.axd_config_dialog=Az;AU("body").append(Az);Ar(Ay)},error_phrase:"error_fetching_dialog"})}function Ar(Az){var Ay=Az.adlocation;AU("#axd-config-dialog").dialog({title:vBulletin.phrase.get(Az.adid?["edit_ad_x",Az.title]:"create_ad"),autoOpen:true,modal:true,resizable:false,closeOnEscape:false,showCloseButton:false,width:720,dialogClass:"dialog-container axd-dialog-container input-dialog",open:function(){var A0=AU(this);if(Az.adid){AU(".title",A0).val(Az.title);AU(".axd_html",A0).val(Az.snippet);if(Az.active=="1"){AU(".active",A0).prop("checked",true)}else{AU(".active",A0).prop("checked",false)}AU(".axdid",A0).val(Az.adid);for(var A1 in Az.criterias){AU("[name=data\\[criteria\\]\\["+Az.criterias[A1].criteriaid+"\\]\\[active\\]]",A0).prop("checked",true);AU("[name=data\\[criteria\\]\\["+Az.criterias[A1].criteriaid+"\\]\\[condition1\\]]",A0).val(Az.criterias[A1].condition1);AU("[name=data\\[criteria\\]\\["+Az.criterias[A1].criteriaid+"\\]\\[condition2\\]]",A0).val(Az.criterias[A1].condition2);AU("[name=data\\[criteria\\]\\["+Az.criterias[A1].criteriaid+"\\]\\[condition3\\]]",A0).val(Az.criterias[A1].condition3)}}else{AU(".axdid",A0).val(0);AU(".configform",A0).trigger("reset")}AU(".axd_location",A0).val(Ay);AU(".blockrow select.custom-dropdown",A0).selectBox();AU(".blockrow a.custom-dropdown, .blockrow input[type=text]",A0).on("click",function(A3){return false});AU(".btnAttachHtmlAxd",A0).off("click").on("click",function(){var A3=AU(".configform",A0).serialize();AU("body").css("cursor","wait");vBulletin.AJAX({call:"/ajax/api/ad/save",data:A3,success:function(A4){A2();Am=Av(AU(".configform .axd_html",A0).val())},complete:function(){AU("body").css("cursor","default")}})});AU(".btnCancelEditHtmlAxd",A0).off("click").on("click",function(){A2(true)});function A2(A3){A3=A3||false;AU(":checkbox",A0).prop("checked",false);AU("select",A0).val("");A0.dialog("close");A0.dialog("destroy");AU("#axd-config-dialog").remove();Aw(A3)}}})}function Av(A0){var Az=AU("<div>"+A0+"</div>");if(Az.filter("script").length>0){return true}else{var Ay=Az.find("*").filter(function(){return(this.nodeName.toLowerCase().indexOf("vb:")==0)?this:null});return(Ay.length>0||(/\{vb\s*\:\s*[a-z]+\s+.*\}/).test(A0))}}return false});AU("#header .header-cell .js-edit-logo").on("click",function(){AU(".header-edit-box.selected").removeClass("selected");AU(this).closest(".header-edit-box").addClass("selected");AU("#edit-site-logo-dialog").dialog({title:vBulletin.phrase.get("edit_site_logo"),autoOpen:true,modal:true,resizable:false,closeOnEscape:false,showCloseButton:false,width:520,dialogClass:"dialog-container site-logo-dialog-container input-dialog",create:function(){var Ar=AU(this).closest(".ui-dialog").find(".ui-dialog-title");Ar.append('<span class="dialog-subtitle"></span>');Ar.children("span.dialog-subtitle").text(vBulletin.phrase.get("choose_options_site_logo"));AU("#btnCancelEditSiteLogo").on("click",function(){AU("#edit-site-logo-dialog").dialog("close")});AU("#btnSaveEditSiteLogo").on("click",function(){if(Number(AU("#header .site-logo img").attr("data-fileid"))>0){AH(function(){AU("#edit-site-logo-dialog").dialog("close")})}else{AU("#edit-site-logo-dialog").dialog("close")}});AU("#edit-site-logo-dialog .styleselection").change(function(){AU("#header .site-logo img").attr({"data-styleselection":AU(this).val()})});AU("#edit-site-logo-dialog").fileupload({dropZone:null,dataType:"json",add:function(At,As){AU("body").css("cursor","wait");AU(At.target).find(".js-upload-progress:first").removeClass("h-hide");As.submit()},done:function(At,As){if(As.result&&As.result.filedataid){AU("#header .site-logo img").attr({src:As.result.imageUrl,"data-fileid":As.result.filedataid,"data-styleselection":AU("#edit-site-logo-dialog .styleselection:checked").val()})}else{openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_uploading_logo"),iconType:"error"})}},fail:function(At,As){openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_uploading_logo"),iconType:"error"})},always:function(At,As){AU("body").css("cursor","auto");AU(At.target).find(".js-upload-progress:first").addClass("h-hide")}});AU("#edit-site-logo-dialog #btnAttachLogo").on("click",function(){var As=AU.trim(AU("#edit-site-logo-dialog #imageUrl").val());if(As){AU("body").css("cursor","wait");AU(this).closest(".dialog-content").find(".js-upload-progress:last").removeClass("h-hide");AU.ajax({url:vBulletin.getAjaxBaseurl()+"/uploader/Url",data:({urlupload:As}),type:"POST",dataType:"json",complete:function(){console.log("uploader/url complete.");AU("body").css("cursor","auto");AU("#edit-site-logo-dialog .js-upload-progress:last").addClass("h-hide")},success:function(At){console.log("saving site logo successful! result:"+At);if(At&&!At.error){AU("#header .site-logo img").attr({src:At.imageUrl,"data-fileid":At.filedataid,"data-styleselection":AU("#edit-site-logo-dialog .styleselection:checked").val()})}else{if(At.error){openAlertDialog({title:vBulletin.phrase.get("edit_site_logo"),message:vBulletin.phrase.get("invalid_image_url"),iconType:"warning",onAfterClose:function(){AU("#edit-site-logo-dialog #imageUrl").select().focus()}})}else{openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_processing_site_logo"),iconType:"error",onAfterClose:function(){AU("#edit-site-logo-dialog #imageUrl").focus()}})}}},error:function(Av,Au,At){console.log("remote url site logo failed! error:"+At);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_processing_site_logo_image_hosting",Av.status),iconType:"error",onAfterClose:function(){AU("#edit-site-logo-dialog #imageUrl").focus()}})}})}else{AU("#edit-site-logo-dialog #imageUrl").focus()}})}})});AU(".admin-button-flat").disableSelection();var Al=function(Ar){Ai()};f=AU("#edit-content .tabs").tabs({beforeActivate:function(As,At){AU("#save-content").hide();if(At.newTab.index()==1){if(l){AU("#edit-page-dropdown .layout-list .layout-border.selected").removeClass("selected");var Ar=AU("#edit-page-dropdown .layout-list input[type=radio][value={0}]".format(AU(".canvas-layout:visible").attr("data-layout-id")));Ar.prev().addClass("selected");Ac="canvas-"+Ar.attr("id")}}},create:function(Ar,As){Al(As.tab.index())},activate:function(Ar,As){Al(As.newTab.index())}});AU("#lnkAddModules").on("click",function(){f.tabs("option","active",0);return false});AR();AU(document).on("click",".module-buttons .hide-icon input",function(){var As=AU(this);As.closest(".canvas-widget")[this.checked?"addClass":"removeClass"]("hidden-widget");var Ar=As.attr("title");As.attr("title",As.data("toggle-title")).data("toggle-title",Ar)});AU(".canvas-layout-container .canvas-layout").each(function(){AA[this.id]=AU("#"+this.id+' div[class*="section-"]').length});if(!t){Ac="canvas-"+AU("#edit-page-dropdown .layout-list input[type=radio][value={0}]".format(AU(".canvas-layout:visible").attr("data-layout-id"))).prop("checked",true).attr("id")}AE=AU("#edit-page-dropdown .layout-list input[type=radio]").thumbnailRadioCheckbox({thumbnailClass:"layout-border"});AE.thumbnailRadioCheckbox("option","select",function(As,Ar){AU(".canvas-layout").addClass("h-hide");AU("#canvas-"+Ar.attr("id")).removeClass("h-hide");B("canvas-"+Ar.attr("id"));O();z();s=true})}function B(An){if(!Ac){AU(".canvas-layout.h-hide input[type=hidden]").prop("disabled",true);AU("#"+An+" input[type=hidden]").prop("disabled",false);Ac=An;return }else{if(Ac==An){return }else{AU(".canvas-layout.h-hide input[type=hidden]").prop("disabled",true);AU("#"+An+" input[type=hidden]").prop("disabled",false);var Al=AA[An];var Ak=false;var Am=0;AU("#"+Ac+" > .canvas-layout-row > .canvas-widget-list").each(function(){var As=AU(this);Ak=AQ(As,AU("#"+An+" > .canvas-layout-row > .canvas-widget-list"));if(!Ak.length){Am=J(this);Ak=AU("#"+An+" > .canvas-layout-row > div.section-"+Am)}if(!Ak.length){var Ao=Al;while(Ao>=0&&AU("#"+An+" > .canvas-layout-row > div.section-"+Ao).length==0){Ao--}Ak=AU("#"+An+" > .canvas-layout-row > div.section-"+Ao)}var Aq=As.children(".canvas-widget");var At=parseInt(Math.ceil(Aq.length/Ak.length),10);console.log("Moving {0} widgets to {1} sections; ChunkSize {2}".format(Aq.length,Ak.length,At));if(At>0){var Ar=0,Ap=0;Aq.each(function(){AU(this).appendTo(Ak.eq(Ap));++Ar;if(Ar>=At){Ar=0;++Ap}})}})}}Ac=An}function AQ(Ak,Am){var Ao=["js-sectiontype-notice","js-sectiontype-primary","js-sectiontype-secondary","js-sectiontype-extra"],Al,An;for(Al in Ao){if(Ak.is("."+Ao[Al])){An=Ao[Al];break}}return Am.filter(function(){return AU(this).is("."+An)})}function J(Am){var Al=/section-(\d+)/gi;var Ak=null;AU(AU(Am).attr("class").split(" ")).each(function(Ao,Ap){var An=Al.exec(Ap);if(An&&!isNaN(An[1])){Ak=An[1]}});return Ak}function Ad(Ak){if(!AU.isArray(Ak)||Ak.length==0){return }window.vBulletin.loadingIndicator.show();AU("body").css("cursor","wait");AU.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/admin-template/widget",data:({widgets:Ak,pagetemplateid:AU("#save-page-form #pagetemplateid-yes").val()}),type:"POST",dataType:"json",complete:function(){console.log("admin-template/widget complete. moduleLoaded="+AF);if(AF){window.vBulletin.loadingIndicator.hide()}AU("body").css("cursor","auto")},success:function(Al){console.log("admin-template/widget successful! result:");console.dir(Al);d=true;if(Al&&AU.isArray(Al.widgets)){AU.each(Al.widgets,function(Am,Ao){if(!Ao.widgetid||Number(Ao.widgetid)<1||!AU.trim(Ao.template)){return true}var Ap=(Ao.displaysection&&Number(Ao.displaysection)>0)?Ao.displaysection:0;var An=AU(Ao.template);An.appendTo(AU(".canvas-layout:not(.h-hide) .canvas-widget-list.section-"+Ap).height("auto")).filter(":not(.container-widget)").find(".toggle-button").trigger("click",[true]);An.find(".tabs").tabs()})}else{openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("invalid_server_response_please_try_again"),iconType:"error"})}},error:function(An,Am,Al){console.log("admin-template/widget failed! error:"+Al);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_adding_widgets",An.status),iconType:"error"})}});return false}function Ab(Ak,Al){var Am=Ak.closest(".channel-item-container").children(".sub-channel-container").children(".channel-item-container");if(Ak.text()=="<"){Ak.text(">");Am.slideDown(150)}else{if(typeof (Al)==="undefined"||!Al){Ak.text("<");itemContainer.slideUp(150)}}}function K(){AU(".channel-config-dialog .channel-list").sortable({placeholder:"main-channel-container-highlight drag-highlight h-clear",update:function(Ak,Al){Al.item.css("z-index","0");o.forum=true;v=true},sort:function(Ak,Al){},start:function(Ak,Al){if(AU.browser.msie&&parseInt(AU.browser.version,10)==8){Al.item.height(Al.item.height()-4)}Al.item.css("z-index","99999");Al.placeholder.height(Al.item.outerHeight())},over:function(Ak,Al){},receive:function(Ak,Al){},out:function(Ak,Al){},handle:".grip-icon-main",items:".main-channel-container"})}function F(Ak){AC=Ak.find(".main-channel-container").sortable({connectWith:".sub-channel-container",placeholder:"channel-item-highlight drag-highlight",revert:true,update:function(Al,Am){var An=Am.item.closest(".main-channel-container");if(Am.sender&&Am.sender.hasClass("main-channel-container")){if(AU("> .channel-item-container",Am.sender).length==0){Am.sender.slideUp("fast",function(){AU(this).remove()})}}o.forum=true;v=true},sort:function(Al,Am){},activate:function(Al,Am){},start:function(Al,Am){},stop:function(Al,Am){AU(".main-channel-container, .sub-channel-container").height("auto")},over:function(Al,Am){},receive:function(Al,Am){},out:function(Al,Am){},handle:".channel-item-inner > .grip-icon-item",items:".channel-item-container"})}function U(Ak){AI=Ak.find(".sub-channel-container").sortable({connectWith:".sub-channel-container",revert:true,placeholder:"channel-item-highlight drag-highlight",update:function(Al,Am){if(Am.sender&&Am.sender.hasClass("main-channel-container")){if(AU("> .channel-item-container",Am.sender).length==0){Am.sender.slideUp("fast",function(){AU(this).remove()})}}o.forum=true;v=true},sort:function(Al,Am){},start:function(Al,Am){},stop:function(Al,Am){AU(".main-channel-container, .sub-channel-container").height("auto")},over:function(Am,An){var Al=AU(this).closest(".channel-item-container").children(".channel-item").find(".toggle-button");Ab(Al,true)},receive:function(Al,Am){},out:function(Al,Am){},handle:".channel-item-inner > .grip-icon-item",items:".channel-item-container"})}function Ae(Ak,An,Ao,Ap,As,Au,Ar){var Aq='<div class="'+(As?"category-to-channel":"channel-to-category")+'"><a href="#">'+vBulletin.phrase.get((As?"make_forum":"make_category"))+"</a></div>";var At=AU(('<div class="main-channel-container">				<div class="grip-icon grip-icon-main h-left"><div>&uml;</div><div>&uml;</div><div>&uml;</div><div>&uml;</div><div>&uml;</div></div>				<div class="channel-item-container">					<div class="channel-item shadow" data-channel-id="{0}" data-parent-id="{2}">						<div class="channel-item-inner">							<div class="grip-icon grip-icon-item h-left"><div>&uml;</div><div>&uml;</div><div>&uml;</div><div>&uml;</div><div>&uml;</div></div>							<div class="channel-title"><div title="'+vBulletin.phrase.get("click_text_edit_title")+'">{1}</div><input type="text" name="channeltitle" value="{1}" /></div>							<div class="close-button" title="'+vBulletin.phrase.get("remove_forum")+'">x</div>							<div class="toggle-button"><</div>							<div class="num-subchannels">'+Ar+'</div>							<div class="add-subchannel-button h-right" title="'+vBulletin.phrase.get("add_subforum")+'"><a href="#">+</a></div>							'+Aq+'							<div class="h-clear"></div>						</div>					</div>					<div class="sub-channel-container"></div>				</div>		 </div>').format(An,Ap,Ao)).appendTo(Ak);if(Au){var Al=AU("#top-level-forum .channel-config-dialog .channel-list");var Am=Al.find(".main-channel-container").last();AU("html, body").animate({scrollTop:Am.offset().top},"fast")}o.forum=true;v=true;return At}function AO(Am,An,Ao,Ar,Al,Aq){var Ap='<div class="'+(Ar?"category-to-channel":"channel-to-category")+'"><a href="#">'+vBulletin.phrase.get((Ar?"make_forum":"make_category"))+"</a></div>";var As=Al.hasClass("main-channel-container")?AU("> .channel-item-container > .sub-channel-container",Al):AU("> .sub-channel-container",Al);var Ak=AU(('<div class="channel-item-container">				<div class="channel-item shadow" data-channel-id="{0}" data-parent-id="{2}">					<div class="channel-item-inner">						<div class="grip-icon grip-icon-item h-left"><div>&uml;</div><div>&uml;</div><div>&uml;</div><div>&uml;</div><div>&uml;</div></div>						<div class="channel-title"><div title="Click text to edit title">{1}</div><input type="text" name="channeltitle" value="{1}" /></div>						<div class="close-button" title="'+vBulletin.phrase.get("remove_forum")+'">x</div>						<div class="toggle-button"><</div>						<div class="num-subchannels">'+Aq+'</div>						<div class="add-subchannel-button h-right" title="'+vBulletin.phrase.get("add_subforum")+'"><a href="#">+</a></div>						'+Ap+'						<div class="h-clear"></div>					</div>			 </div>			 <div class="sub-channel-container"></div>			</div>').format(Am,Ao,An)).hide().appendTo(As);o.forum=true;v=true;return Ak}function AY(){window.vBulletin.loadingIndicator.show();AU("body").css("cursor","wait");AU.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/fetch-widget-admin-template-list",type:"POST",dataType:"json",complete:function(){console.log("fetch-widget-admin-template-list complete. templatesLoaded="+y);if(y){window.vBulletin.loadingIndicator.hide()}AU("body").css("cursor","auto");Ai();AU(window).resize(Ai)},success:function(Am){console.log("fetch-widget-admin-template-list successful! result:");console.dir({result:Am});AF=true;if(AU.isArray(Am)){if(Am.length>0){var An={},Aq=0;AU.each(Am,function(As,At){if(!At.widgetid||Number(At.widgetid)<1){return true}Aq++;if(!An[At.category]){An[At.category]={count:1,title:At.category_title}}else{An[At.category].count++}var Ar=AU("#edit-page-dropdown .module-list .module-icon-template").clone();Ar.attr("data-widget-id",At.widgetid).attr("data-title",AU.trim(At.title).toLowerCase()).data("canbemultiple",At.canbemultiple).removeClass("module-icon-template").addClass(("module-item category-{0}"+(At.cloneable=="1"?" module-cloneable":"")).format(At.category));AU(".module-icon",Ar).html(AU("<img />").attr("src",pageData.baseurl+"/images/sitebuilder/"+AU.trim(At.icon)).attr("height",60).attr("width",60).attr("alt",vBulletin.phrase.get("module_icon")));AU(".module-title .main-title",Ar).html(AU.trim(At.title));Ar.appendTo("#edit-page-dropdown .module-list").removeClass("h-hide")});AU(('<div class="category-arrow-left h-left" title="'+vBulletin.phrase.get("previous")+'">&lsaquo;</div>							<div class="scroller category h-left">								<div class="categories h-left">									<div id="category-all" class="category selected">'+vBulletin.phrase.get("all")+' ({0})</div>									<div id="category-result" class="category h-hide">'+vBulletin.phrase.get("search_results")+' (<span></span>)</div>								</div>							</div>							<div class="category-arrow-right h-left" title="'+vBulletin.phrase.get("next")+'">&rsaquo;</div>							<div class="h-clear"></div>').format(Aq)).insertBefore("#edit-page-dropdown .module-list-container .scroller");var Al=0;AU.each(An,function(As,At){var Ar=AU('<div id="category-{0}" class="category">{1} ({2})</div>'.format(As,At.title,At.count)).insertBefore("#category-result");Al+=Ar.outerWidth(true)});var Ap=Al+AU("#category-all").outerWidth(true);AU(".categories").width(Ap);if(AU(".categories").width()<=AU(".scroller.category").width()){AU(".category-arrow-left, .category-arrow-right").css("visibility","hidden")}else{AU(".category-arrow-right").css("visibility","visible")}Aj();b=AU("#edit-page-dropdown .module-list .module-item").not(".non-module-item");b.draggable({connectToSortable:".canvas-layout-row > .canvas-widget-list:visible",helper:"clone",revert:"invalid",appendTo:"#add-modules .module-list-container",zIndex:2000,start:function(Ar,As){if(AU(this).data("canbemultiple")=="0"&&AU("#content .canvas-layout .canvas-widget[data-widget-id={0}]".format(AU(this).attr("data-widget-id"))).length>0){openAlertDialog({title:vBulletin.phrase.get("move_not_allowed"),message:vBulletin.phrase.get("adding_multiple_modules_not_allowed",AU(".main-title",this).html()),iconType:"warning"});return false}u=true},stop:function(Ar,As){u=false}}).disableSelection();var Ak=false;AU("#search-module-keyword").on("keyup",function(Ar,Az){var Ay=AU("#add-modules");var Av=AU("#category-result");var As=AU(".categories",Ay);var At=AU(".scroller.category",Ay);var Au=false;AU(".module-item",Ay).hide();if(!Az){AU(".category.selected",Ay).removeClass("selected")}var Ax=AU.trim(this.value.toLowerCase());if(Ax){AU('.module-item[data-title*="{0}"]'.format(Ax),Ay).show();Av.removeClass("h-hide").addClass("selected")}else{AU(".module-item",Ay).show();AU("#category-all").removeClass("h-hide").addClass("selected");Av.addClass("h-hide").removeClass("selected");Au=true}var A0=AU(".module-item:visible",Ay).length;AU("span",Av).text(A0);Aj();if(A0==0){AU(".empty-module",Ay).show()}else{AU(".empty-module",Ay).hide()}if(Au){As.width(Ap)}else{As.width(Ap+Av.outerWidth(true))}if(As.width()<=At.width()){AU(".category-arrow-left, .category-arrow-right",Ay).css("visibility","hidden");At.scrollLeft(0)}else{if(Au){AU(".category-arrow-left",Ay).css("visibility","hidden");AU(".category-arrow-right",Ay).css("visibility","visible");At.scrollLeft(0)}else{AU(".category-arrow-left",Ay).css("visibility","visible");AU(".category-arrow-right",Ay).css("visibility","hidden");var Aw=At.get(0);At.scrollLeft(Aw.scrollWidth-Aw.clientWidth)}}return true});AU("#add-modules .categories .category").on("click",function(At){At.stopPropagation();if(AU(this).hasClass("selected")){return false}var Ar=AU(this).closest(".module-list-container");var Au=AU(".module-item",Ar);AU(".category.selected",Ar).removeClass("selected");AU(this).addClass("selected");Au.hide();AU(".empty-module",Ar).hide();var As=this.id;if(As=="category-all"){Au.show();AU(".non-module-item",Ar).hide()}else{if(As=="category-result"){AU("#search-module-keyword").triggerHandler("keyup",[true])}else{AU(".module-item.{0}".format(As),Ar).show()}}Aj();return false}).disableSelection();var Ao;AU(".category-arrow-left").on({mousedown:function(){AU(".category-arrow-right").css("visibility","visible");Ao=setInterval(function(){var Ar=AU(".scroller.category");Ar.scrollLeft(Ar.scrollLeft()-20);if(Ar.scrollLeft()==0){AU(".category-arrow-left").css("visibility","hidden");clearInterval(Ao)}},50)},mouseup:function(){clearInterval(Ao)}}).disableSelection();AU(".category-arrow-right").on({mousedown:function(){AU(".category-arrow-left").css("visibility","visible");Ao=setInterval(function(){var As=AU(".scroller.category");As.scrollLeft(As.scrollLeft()+20);var Ar=As.get(0);if(As.scrollLeft()==Ar.scrollWidth-Ar.clientWidth){AU(".category-arrow-right").css("visibility","hidden");clearInterval(Ao)}},50)},mouseup:function(){clearInterval(Ao)}}).disableSelection()}else{AU('<div class="empty-module">'+vBulletin.phrase.get("no_modules")+"</div>").appendTo("#edit-page-dropdown .module-list")}}else{openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("invalid_server_response_please_try_again"),iconType:"error"})}},error:function(Am,Al,Ak){console.log("fetch-widget-admin-template-list failed! error:"+Ak);window.vBulletin.loadingIndicator.hide();openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_retrieving_modules",Am.status),iconType:"error"})}})}function m(Al,Ak){vBulletin.AJAX({call:"/ajax/api/widget/fetchWidgetGuidToWidgetidMap",success:function(Am){if(Am.map){AN=Am.map}else{AN={error_result:Am}}if(typeof Al=="function"){Al.apply(this,Ak)}}})}function p(){window.vBulletin.loadingIndicator.show();AU("body").css("cursor","wait");AU("#edit-page-dropdown .template-list").empty();AU.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/pagetemplate/fetchPageTemplateList",dataType:"json",data:{pagetemplateid:AU("#save-page-form #pagetemplateid-yes").val()},type:"POST",complete:function(){console.log("fetchPageTemplateList complete.");if(AF){window.vBulletin.loadingIndicator.hide()}AU("body").css("cursor","auto")},success:function(Al){console.log("fetchPageTemplateList successful! result:");console.dir({templates:Al});y=true;if(AU.isArray(Al)&&Al.length>0){var Ak=false;AU.each(Al,function(Am,An){AU('<div class="template-item">								<input type="radio" id="pagetemplateid-{0}" name="pagetemplateid" value="{0}" data-thumbnail="{1}/images/sitebuilder/icon-layout-{4}.png"{2} />								<label class="label">{3}</label>							</div>'.format(An.pagetemplateid,pageData.baseurl,(!t&&AU("#save-page-form #pagetemplateid-yes").val()==An.pagetemplateid)?' checked="checked"':"",An.title,An.screenlayoutvarname)).appendTo("#edit-page-dropdown .template-list").data({screenlayoutid:An.screenlayoutid,widgetinstances:An.widgetinstances});if(AU("#save-page-form #pagetemplateid-yes").val()==An.pagetemplateid){Ak=true;if(An.title==""){window.console.warn("The page template for this page does not have a title.")}}});if(!t&&!Ak){window.console.error("The page template for this page was not in the list returned by fetchPageTemplateList! Expected pagetemplateid: {0}. Please ensure that this page template has a title.".format(AU("#save-page-form #pagetemplateid-yes").val()))}AU(".template-item",AU("#edit-page-dropdown .template-list")).each(function(Am){AU(this).attr("data-title",AU(".label",AU(this)).text().toLowerCase())});AU("#search-template-keyword").on("keyup",function(Aq){if(Aq.keyCode==13){Aq.preventDefault();return false}var An=AU("#select-template");var Ar=AU(".scroller",An);var Ap=false;AU(".template-item",An).hide();var Am=AU.trim(this.value.toLowerCase());if(Am){AU('.template-item[data-title*="{0}"]'.format(Am),An).show()}else{AU(".template-item",An).show();Ap=true}var Ao=AU(".template-item:visible",An).length;Aj();if(Ao==0){AU(".empty-template",An).show()}else{AU(".empty-template",An).hide()}return true});AU("#search-template-keyword").on("keydown",function(Am){if(Am.keyCode==13){Am.preventDefault();return false}});a=AU("#edit-page-dropdown .template-list .template-item input[type=radio]").thumbnailRadioCheckbox({thumbnailClass:"template-border",preselect:function(An,Am){if(Am.is(":checked")){return false}if(s||v){openConfirmDialog({title:vBulletin.phrase.get("switch_template"),message:vBulletin.phrase.get("template_changes_will_be_lost"),iconType:"warning",onClickYes:function(){s=false;v=false;l=true;a.thumbnailRadioCheckbox("check",Am,true)}});return false}l=true;return true},select:function(Aq,Am){AU(".canvas-layout").addClass("h-hide");var Ao=Am.closest(".template-item").data("screenlayoutid");AU(".canvas-layout[data-layout-id="+Ao+"]").removeClass("h-hide");O();z();AU("#save-page-form #pagetemplateid-yes, #config_pagetemplateid").val(Am.val());AU("#save-page-form .page-template-name").html(vBulletin.phrase.get("page_template_name_id",Am.closest(".template-item").find(".label").html(),Am.val()));if(l){AU(".canvas-widget-list").empty();var An=Am.closest(".template-item").data("widgetinstances");if(AU.isArray(An)&&An.length>0){d=false;var Ap=[];AU.each(An,function(Ar,As){Ap.push({widgetid:As.widgetid,widgetinstanceid:As.widgetinstanceid})});Ad(Ap,true);M()}else{window.vBulletin.loadingIndicator.hide()}}AU("body").removeClass("lnkNewPage").addClass("lnkEditPage");AU("#save-page-form .new-page-template input").prop("disabled",true);AU("#save-page-form .edit-page-template input").prop("disabled",false);l=true},unselect:function(){}});Aj()}else{window.vBulletin.loadingIndicator.hide();openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_retrieving_templates"),iconType:"error"})}},error:function(Am,Al,Ak){console.log("fetchPageTemplateList failed! error:"+Ak);window.vBulletin.loadingIndicator.hide();openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_retrieving_modules",Am.status),iconType:"error"})}})}function AH(Ak,Am,Al){AU.ajax({url:vBulletin.getAjaxBaseurl()+"/uploader/setlogo",data:({filedataid:AU("#header .site-logo img").attr("data-fileid"),styleselection:AU("#header .site-logo img").attr("data-styleselection")}),type:"POST",dataType:"text",complete:function(){console.log("uploader/setlogo complete.");AU("body").css("cursor","auto")},success:function(An){console.log("saving site logo successful! result:"+An);if(AU.trim(An)==="true"){AU("#header .site-logo img").removeAttr("data-styleselection").removeAttr("data-fileid").attr("data-orig-src",AU("#header .site-logo img").attr("src"));AU("#admin-navbar-strip-gutter").addClass("h-hide").find(".prompt-text").text("");AU(document.body).removeClass("edit-mode lnkHeader").addClass("view-mode");AU("#header .disable-overlay").hide();L(null,{enableButtons:true,currentButton:null});if(typeof Ak=="function"){Ak()}}else{console.log("saving site logo failed!");openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_saving_site_logo"),iconType:"error"});if(typeof Am=="function"){Am()}}},error:function(Ap,Ao,An){console.log("saving site logo failed! error:"+An);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_saving_site_logo_code",Ap.status),iconType:"error"});if(typeof Al=="function"){Al()}}})}function N(Ak,Al){AU.each(Ak,function(An,Am){var Ao=AU(('<div class="sub-channel channel" data-channel-id="{0}" data-parent-id="{6}">				<div class="avatar h-left"></div>				<div class="title"><a href="{1}{2}">{3}</a></div>				<div class="info">					<span class="label">'+vBulletin.phrase.get("last_post")+':</span>					<span class="title">{4}</span>				</div>				<div class="h-clear"></div>').format(Am.nodeid,pageData.baseurl,Am.url,Am.title,(Am.lastPostTitle?Am.lastPostTitle:"<em>"+vBulletin.phrase.get("none")+"</em>"),pageData.baseurl_core,Am.parentid)).appendTo(Al);N(Ak[An].subchannels,Ao.eq(0))})}function AG(Al,Ak){AU.each(Al,function(Am,Ao){var An=AU.map(Ao.subchannels,function(Ar,Aq){return Aq}).length;var Ap=AO(Ao.nodeid,Ao.parentid,Ao.title,Ao.category,Ak,An);AG(Ao.subchannels,Ap)})}function AX(){f.tabs("option","active",0);var Aq=AU("#add-modules").height();f.tabs("option","active",1);var Ak=AU("#change-layout").height();f.tabs("option","active",2);var Al=AU("#select-template").height();AU("#edit-page-dropdown .lnkSaveChanges").trigger("click");var An=AU("#save-page-form").height();f.tabs("option","active",0);var Ap=Math.max(Aq,Ak,Al,An);var Am=AU("#edit-page-dropdown .panel-header-text");Am.each(function(){var Ar=AU(this);Ar.css("min-height",Ap-parseFloat(Ar.css("margin-top"))-parseFloat(Ar.css("margin-bottom"))-parseFloat(Ar.css("padding-top"))-parseFloat(Ar.css("padding-bottom")))});var Ao=AU("#edit-page-dropdown .panel-main-content");Ao.each(function(){var Ar=AU(this);Ar.css("min-height",Ap-parseFloat(Ar.css("margin-top"))-parseFloat(Ar.css("margin-bottom"))-parseFloat(Ar.css("padding-top"))-parseFloat(Ar.css("padding-bottom")))})}function X(Ak,Al){var Am=(Al&&Al.length>0)?AU(".canvas-layout .canvas-widget").not(Al).find(".widget-content"):AU(".canvas-layout .canvas-widget .widget-content");if(Ak){Am.each(function(){if(AU(this).is(":hidden")){AU(this).closest(".canvas-widget").find(".widget-header .toggle-button").trigger("click",[true])}})}else{Am.each(function(){if(!AU(this).is(":hidden")){AU(this).closest(".canvas-widget").find(".widget-header .toggle-button").trigger("click",[true])}})}}function k(Al,Ak){if(Ak){if(Al.find(".widget-content").is(":hidden")){Al.find(".toggle-button").trigger("click",[true])}}else{if(!Al.find(".widget-content").is(":hidden")){Al.find(".toggle-button").trigger("click",[true])}}}function M(){if(!t){var Ak=AU(".canvas-layout:visible .canvas-widget.subchannel-widget");if(Ak.length==1){Ak.find(".close-button").hide()}else{Ak.find(".close-button").show()}}}function Ah(Am,Ak){var Al=Am.attr("data-widget-id");if(x[Al]==null){window.vBulletin.loadingIndicator.show();AU("body").css("cursor","wait");AU.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/fetch-widget-template",data:({widgetid:Al}),type:"POST",dataType:"json",complete:function(){window.vBulletin.loadingIndicator.hide();AU("body").css("cursor","auto")},success:function(An){console.log("Fetching module admin template successful");var Ap=AU.trim(An);if(Ap){var Ao=AU(Ap.replace(/\<\s*script[^\>]*\>(.*?)\<\s*\/\s*script\>/g,""));Ao.attr("data-title",function(){var Aq=AU(".module-title",Ao).clone();Aq.find(".hide-on-viewmode").children().unwrap();Aq.find("*:hidden").remove();return AU.trim(Aq.text()).toLowerCase()});x[Al]=Ao;if(typeof Ak=="function"){Ak(Ao.clone(true))}}},error:function(Ap,Ao,An){console.log("Fetching module admin template failed, error: "+An);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_retrieving_cloned_widget_template",Ap.status),iconType:"error"})}})}else{if(typeof Ak=="function"){Ak(x[Al].clone(true))}}}function E(Ak,Al){AU(".edit-mode .canvas-widget.youtube-widget .widget-content").css("visibility",Ak);if(Al){Al.find(".widget-content").css("visibility",(Ak=="hidden"?"visible":"hidden"))}}function C(Ak){var An="js-sb-module-config--viewpermissions--template";if(!An.length){return""}if(!Ak.hasOwnProperty("defaultvalue")){Ak.defaultvalue={show:"all",}}var Ar=AU("."+An).clone().removeClass(An+" h-hide"),At=Ak.defaultvalue,As=(At.hasOwnProperty("hide")?"hide":"show"),Ap=(As=="show"&&typeof At[As]=="string"&&At[As]=="all"),Al=Ar.find("input.js-module_viewpermissions__key[value='show_all']"),Aq=Ar.find("input.js-module_viewpermissions__key[value='show']"),Am=Ar.find("input.js-module_viewpermissions__key[value='hide']"),Ao=Ar.find(".js-module_viewpermissions_ugchecklist");if(As=="hide"){As="show";Ap=true;Al.prop("checked",false);Aq.prop("checked",true)}if(As=="hide"){Al.prop("checked",false);Aq.prop("checked",false);Am.prop("checked",true)}else{if(Ap){Al.prop("checked",true);Aq.prop("checked",false);Am.prop("checked",false);Ao.addClass("h-hide")}else{Al.prop("checked",false);Aq.prop("checked",true);Am.prop("checked",false)}}if(!Ap){AU.each(At[As],function(Au,Av){Ao.find("input.js-module_viewpermissions__value[value='"+Av+"']").prop("checked",true)})}Ar.find("input.js-module_viewpermissions__key").on("change",function(Au){if(this.value=="show_all"){Ao.addClass("h-hide")}else{Ao.removeClass("h-hide")}});return Ar}function AR(){AU(document).off("click",".canvas-widget.default-widget:not(.js-search-widget) .edit-button").on("click",".canvas-widget.default-widget:not(.js-search-widget) .edit-button",function(){var Ar=AU(this).closest(".canvas-widget"),Al=Ar;var Am=AU("> .widget-header .module-title",Ar);(function(){var As=Ar.data("widget-instance-id");if(vBulletin.sitebuilder.tempModuleHTMLCache["widgetinstance_"+As]){if(AU("#sb-temp-module-cache").length==0){AU('<div id="sb-temp-module-cache" class="h-hide"></div>').appendTo("body")}var At=AU(vBulletin.sitebuilder.tempModuleHTMLCache["widgetinstance_"+As]);if(At.find(".widget-tabs").length>0||At.is(".widget-tabs")){AU("#sb-temp-module-cache").append(At);delete vBulletin.sitebuilder.tempModuleHTMLCache["widgetinstance_"+As]}}var Au=AU("#sb-temp-module-cache .canvas-widget").filter(function(){return AU(this).data("widget-instance-id")==As});if(Au.length==1&&(Au.find(".widget-tabs").length>0||Au.is(".widget-tabs"))){Ar=Au}})();if(Ar.is(".js-search-widget")){return }AU("body").css("cursor","wait");var Ao=Ar.attr("data-widget-id");var An;if(AU("span.admin-only",Am).length>0){An=AU("span.admin-only",Am).text()}else{An=AU(".hide-on-viewmode",Am).length>0?AU(".hide-on-viewmode",Am).text():Am.text()}var Aq=Ar.data("widget-type")||"";AU("#config-dialog .loader").show();AU("#config-dialog .widget-name h1").html(An);AU("#config-dialog .dialog-content .widget-config-container").hide().empty().removeClass("error notice");AU("#config-dialog").data("selected-module",Al);E("hidden");AU("#config-dialog").dialog("open");var Ap=Al.attr("data-widget-instance-id")||"";AU.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/widget/fetchConfigSchema",data:({widgetid:Ao,widgetinstanceid:Ap,pagetemplateid:W(),configtype:"admin"}),type:"POST",dataType:"json",complete:function(){AU("body").css("cursor","auto")},success:function(A7){console.log("fetchConfigSchema successful! result:"+JSON.stringify(A7));if(A7){AU("#config_widgetid").val(A7.widgetid);AU("#config_widgetinstanceid").val(A7.widgetinstanceid);c(A7.pagetemplateid);Al.attr("data-widget-instance-id",A7.widgetinstanceid);if(!Ap){R(Al)}if(!A7.configs||A7.configs.length==0){AU("#config-dialog .widget-config-container").html(vBulletin.phrase.get("no_configurations_found")).addClass("notice");AU("#btnSaveConfig").prop("disabled",true);AU("#btnCloseConfig").focus()}else{var A9=0;var A8=AU("#config-dialog .dialog-content .widget-config-container");AU('<input type="hidden" name="data[widget_type]" />').addClass("widget-type").val(Aq).appendTo(A8);var BE=false,Au=false,A3=false,Ax=false,BG,BF=false,A2=Al.data("is-tabbed-container"),A4={display_tabs:false,default_tab:false},A1=(AU("#debug-information").length==1);AU.each(A7.configs,function(BS,BL){var BK=null;switch(BL.type){case"ChannelSetup":AU("#config-dialog .dialog-content .channel-config-dialog").css("display","block");return true;break;case"Text":var BM=typeof (BL.defaultvalue!="undefined")?BL.defaultvalue:"";BK=AU('<input type="text" name="data[{0}]" id="data[{0}]" />'.format(BL.name)).addClass("textbox config-textbox").val(BM);break;case"LongText":var BM=typeof (BL.defaultvalue!="undefined")?BL.defaultvalue:"";BK=AU('<textarea name="data[{0}]" id="data[{0}]" rows="3" />'.format(BL.name)).addClass("textbox config-textbox").val(BM);break;case"YesNo":var BQ={option_1:AU('<input type="radio" value="1" name="data[{0}]" id="data[{0}_1]" />'.format(BL.name)),label_1:AU("<label />").attr({"for":"data["+BL.name+"_1]"}).text(vBulletin.phrase.get("yes")),option_0:AU('<input type="radio" value="0" name="data[{0}]" id="data[{0}_0]" />'.format(BL.name)),label_0:AU("<label />").attr({"for":"data["+BL.name+"_0]"}).text(vBulletin.phrase.get("no"))};var BW=BQ["option_"+BL.defaultvalue];if(BW){BW.prop("checked",true)}BK=AU("<div />").append(BQ.option_1,BQ.label_1,BQ.option_0,BQ.label_0);break;case"Checkboxes":BK=AU("<div />");AU.each(BL.data,function(BY,Ba){var BZ="";if(BL.defaultvalue&&typeof BL.defaultvalue[BY]!="undefined"&&BL.defaultvalue[BY]==1){BZ=' checked="checked"'}var Bb=AU('<div><label><input type="checkbox" name="data[{0}][{1}]"{2} value="1" class="js-checkbox-always-send" /> {3}</label></div>'.format(BL.name,BY,BZ,Ba));BK.append(Bb)});break;case"Select":BF=true;BK=AU('<select name="data[{0}]" />'.format(BL.name));var BP;if(BL.data!=""){for(BP in BL.data){if(BL.defaultvalue==BP){AU("<option />").attr("value",BP).attr("selected","selected").text(BL.data[BP]).appendTo(BK)}else{AU("<option />").attr("value",BP).text(BL.data[BP]).appendTo(BK)}}}break;case"ChannelSelect":BF=true;BK=AU('<select name="data[{0}]" />'.format(BL.name));var BU=AU('<optgroup label="{0}" />'.format(vBulletin.phrase.get("special_options"))),BN=AU('<optgroup label="{0}" />'.format(vBulletin.phrase.get("channels"))),BT=false,BV=false;if(BL.data){AU.each(BL.data,function(BY,BZ){var Ba=null;if(BL.defaultvalue==BZ.nodeid){Ba=AU("<option />").attr("value",BZ.nodeid).attr("selected","selected").html(BZ.text)}else{Ba=AU("<option />").attr("value",BZ.nodeid).html(BZ.text)}if(BZ.nodeid<1){Ba.appendTo(BU);BT=true}else{Ba.appendTo(BN);BV=true}});if(BT){BU.appendTo(BK)}if(BV){BN.appendTo(BK)}}break;case"ContentTypeSelect":BF=true;BK=AU('<select name="data[{0}]" />'.format(BL.name));var BU=AU('<optgroup label="{0}" />'.format(vBulletin.phrase.get("special_options"))),BR=AU('<optgroup label="{0}" />'.format(vBulletin.phrase.get("content_types"))),BT=false,BO=false;if(BL.data){AU.each(BL.data,function(BY,Ba){var BZ=null;if(BL.defaultvalue==Ba.value){BZ=AU("<option />").attr("value",Ba.value).attr("selected","selected").html(vBulletin.phrase.get(Ba.phrase))}else{BZ=AU("<option />").attr("value",Ba.value).html(vBulletin.phrase.get(Ba.phrase))}if(Ba.special){BZ.appendTo(BU);BT=true}else{BZ.appendTo(BR);BO=true}});if(BT){BU.appendTo(BK)}if(BO){BR.appendTo(BK)}}break;case"ProfileFieldSelect":BF=true;BK=AU('<select name="data[{0}]" />'.format(BL.name));if(BL.data){AU.each(BL.data,function(BY,Ba){var BZ=null;if(BL.defaultvalue==Ba.field){BZ=AU("<option />").attr("value",Ba.field).attr("selected","selected").html(Ba.title)}else{BZ=AU("<option />").attr("value",Ba.field).html(Ba.title)}BZ.appendTo(BK)})}break;case"Custom":switch(BL.name){case"tab_data":BK=AU("<div />");var BX=g(Al),BJ=AU("<div />");AU.each(BX,function(Bb,BY){var BZ="[tab_data]["+Bb+"][title]",Ba=BY.title,Bc=AU('<input type="text" name="data{0}" id="data{0}" />'.format(BZ)).addClass("textbox config-textbox").attr("value",Ba);BK.append(Bc);AU.each(BY.widgets,function(Bd,Be){AU.each(Be,function(Bg,Bf){BZ="[tab_data]["+Bb+"][widgets]["+Bd+"]["+Bg+"]";Ba=Bf;Bc=AU('<input type="text" name="data{0}" id="data{0}" />'.format(BZ)).addClass("textbox config-textbox").attr("value",Ba);BK.append(Bc)})})});break;case"module_viewpermissions":BK=C(BL);break;default:break}break}$requiredMark=AU("<div />").addClass("config-required-mark h-left").append(function(){return(BL.isRequired==1)?"*":"&nbsp;"});if(BL.isEditable==0&&BK){BK.find("input").prop("readonly",true);if(!BK.is("input")){BK.prop("disabled",true)}}var BI=AU("<div />").addClass("config-label h-left").addClass(BL.name).html(BL.label);if(A1){BI.prop("title",BL.name)}if(BL.description){AU("<div />").addClass("config-description").html(BL.description).appendTo(BI)}if(BL.ishiddeninput&&BK){BK.attr("hidden",true);A8.append(BK)}else{A8.append(AU("<div></div>").addClass(function(){return"h-clearfix config-row"+(((++A9)%2!=0)?" odd":"")}).append(BI,$requiredMark,AU("<div></div>").addClass("config-value h-left").addClass(BL.name).append(BK)))}if(BL.name=="default_tab"){if(A2){A4.default_tab=BL}else{BE=true}}if(BL.name=="display_tabs"){if(A2){A4.display_tabs=BL}else{Au=true}}if(BL.name=="tab_order"){if(!A2){A3=true}}if(BL.name=="axd"){Ax=true}});var BD=null;var Av=function(){BG=Ak(Ar);var BL=Ar.attr("data-widget-default-tab"),BJ=AU('select[name="data[default_tab]"]',A8),BK;BJ.empty();for(var BI in BG){if(Au){if(!AU('input:checkbox[value="'+BG[BI].selector+'"]',BA).is(":checked")){continue}}else{if(!BG[BI].displayed){continue}}BK=AU('<option value="'+BG[BI].selector+'">'+BG[BI].label+"</option>");if(BD&&BD==BG[BI].selector){BK.attr("selected","selected")}else{if(BL==BG[BI].selector){BK.attr("selected","selected")}}BJ.append(BK)}};var BB=function(){BG=Ak(Ar);var BJ=AU(".config-value.tab_order",A8),BK,BL;BJ.empty().append("<ul>");for(var BI in BG){if(Au){if(!AU('input:checkbox[value="'+BG[BI].selector+'"]',BA).is(":checked")){continue}}else{if(!BG[BI].displayed){continue}}BK=AU('<li id="'+BG[BI].selector+'">'+BG[BI].label+"</li>");AU("ul",BJ).append(BK);BL=AU('<input name="data[tab_order]['+BG[BI].selector.substring(1)+']" value="'+BI+'" type="hidden">');BJ.append(BL)}AU("ul",BJ).sortable({stop:function(){var BM=AU(this).sortable("toArray");BJ.find("input:hidden").remove();for(BI in BM){BL=AU('<input name="data[tab_order]['+BM[BI].substring(1)+']" value="'+BI+'" type="hidden">');BJ.append(BL)}}});AU("ul",BJ).disableSelection()};if(Au){BG=Ak(Ar);var BA=AU(".config-value.display_tabs",A8),Ay;for(var BC in BG){Ay=AU('<label><input type="checkbox" name="data[display_tabs][]" value="'+BG[BC].selector+'">'+BG[BC].label+"</label>");if(BG[BC].displayed){Ay.find("input:checkbox").attr("checked","checked")}BA.append(Ay)}if(BE){AU("input:checkbox",BA).on("click",function(){Av();BB()})}}if(A3){BB();AU('select[name="data[default_tab]"]',A8).change(function(){BD=AU(this).val()})}if(BE){Av()}var At=r(Al);if(At){AU("<input type='hidden' name='data[containerinstanceid]' value='"+At+"' />").appendTo(A8)}if(A2){var A0=g(Al),Aw=AU('select[name="data[default_tab]"]',A8),BH=AU(".config-value.display_tabs",A8),As=A4.display_tabs&&A4.display_tabs.defaultvalue||"";if(As==""){As={};AU.each(A0,function(BJ,BI){As[BJ]="1"})}var A6=function(){var BI;Aw.empty();AU.each(A0,function(BK,BJ){BI=AU('<option value="'+BK+'">'+BJ.title+"</option>");if(As[BK]=="0"){BI.prop("disabled",true)}else{if(A4.default_tab.defaultvalue==BK){BI.attr("selected","selected")}}Aw.append(BI)});if(Aw.is(".selectBox")){Aw.selectBox("refresh")}};if(A4.default_tab){A6()}if(A4.display_tabs){var Az;BH.empty();AU.each(As,function(BK,BJ){var BI="data[display_tabs]["+BK+"]";Az=AU("<label />").append(AU('<input type="hidden" name="'+BI+"\" value='0'/>")).append(AU('<input type="checkbox" name="'+BI+"\" value='1' data-tab-number=\""+BK+'" />')).append(document.createTextNode(A0[BK]["title"]));if(BJ=="1"){Az.find("input:checkbox").prop("checked",true)}BH.append(Az)});AU("input:checkbox",BH).on("click",function(){var BM=AU(this),BJ=BM.prop("checked"),BL=BM.data("tab-number"),BI=Aw.find("option[value='"+BL+"']"),BK=(BI.prop("disabled")!=!BJ);As[BL]=BJ;if(BK){A6()}})}}if(Ax){var A5=AU(".config-value.axd",A8);A5.append('<button class="axd-edit-button b-button b-button--secondary b-button--sitebuilder" data-location="'+A7.widgetinstanceid+'">'+vBulletin.phrase.get("edit")+"</button>")}}}AU("#config-dialog .dialog-content .widget-config-container").show();AU("#config-dialog .loader").hide();if(BF){AU("#config-dialog .dialog-content .widget-config-container select").selectBox()}(function(){function BI(){var BJ=AU(this),BK=BJ.next(".js-checkbox-always-send-hidden");if(BK.length==0&&!BJ.prop("checked")){AU('<input type="hidden" name="{0}" class="js-checkbox-always-send-hidden" value="0" />'.format(BJ.prop("name"))).insertAfter(BJ)}else{BK.remove()}}AU(".js-checkbox-always-send").off("click").on("click",BI);AU(".js-checkbox-always-send").each(BI)})();AU("#config-dialog .dialog-content .widget-config-container input,						#config-dialog .dialog-content .widget-config-container textarea,						#config-dialog .dialog-content .widget-config-container select,						#config-dialog .dialog-content .widget-config-container button").filter(function(){return AU(this).is(":visible")}).first().focus()},error:function(Au,At,As){console.log("fetchConfigSchema failed! error:"+As);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_retrieving_configuration",An),iconType:"error",onAfterClose:function(){AU("#config-dialog").dialog("close")}});AU("#config-dialog .loader").hide()}});return false});function Ak(Am){var Al=[];AU("ul.widget-tabs-nav li a, .widget-header ul.ui-tabs-nav li a, .widget-tabs-nav ul.ui-tabs-nav li a",Am).each(function(){var An=AU(this),Ao;if(AU(this).closest("li").hasClass("h-hide")){Ao=false}else{Ao=true}Al.push({selector:An.attr("href"),label:An.text(),displayed:Ao})});return Al}}function O(){AU(".edit-mode .canvas-layout:visible > .canvas-widget-list").width("").each(function(){AU(this).width(AU(this).width())})}function z(){if(AU.browser.msie&&parseInt(AU.browser.version,10)==8){var Ak=AU(".edit-mode .canvas-layout:visible > .canvas-widget-list");Ak.each(function(){var Al=AU(".canvas-widget",this),Ar=AU(this);var Am=Al.outerHeight(true)||50;var An=Al.length*Al.outerHeight(true);var Aq=Ar.height()-An;console.log("offset:",Aq);if(Aq>=0&&Aq<Am){var Ap=AU(window);var Ao=Ap.scrollTop();Ar.height(Ar.height()+(Am-Aq));Ap.scrollTop(Ao);return false}else{if((Aq>Am&&Ar.height()>parseInt(Ar.css("min-height"),10))||Aq<0){var Ap=AU(window);var Ao=Ap.scrollTop();Ar.height(An+Am);Ap.scrollTop(Ao);return false}}})}}function AJ(){window.console.log("Fetching page manager forums (initializeForumEditor)");vBulletin.AJAX({url:vBulletin.getAjaxBaseurl()+"/ajax/api/widget/fetchPageManagerForums",complete:function(){AU("#config-dialog .loader").hide();AU("body").css("cursor","auto")},success:function(Ak){window.console.log("Successfully fetched page manager forums (initializeForumEditor)");G=true;var Am=AU("<div>").addClass("channel-list");AU.each(Ak,function(Ao,Aq){var Ap=AU.map(Aq.subchannels,function(As,Ar){return Ar}).length;var An=Ae(Am,Aq.nodeid,Aq.parentid,Aq.title,Aq.category,false,Ap);AG(Aq.subchannels,An)});var Al=AU("#top-level-forum .channel-config-dialog");Al.find(".channel-list").remove();F(Am);U(Am);Al.append(Am);AU(document).on("mousedown",".main-channel-container > .channel-item-container > .channel-item .grip-icon",function(){AU(this).closest(".main-channel-container").height(AU(this).closest(".main-channel-container").height())});AU(document).on("mousedown",".sub-channel-container > .channel-item-container > .channel-item .grip-icon",function(){AU(this).closest(".sub-channel-container").height(AU(this).closest(".sub-channel-container").height())});v=false;K()},error_phrase:"error_fetching_channels"});AU(document).on("click keydown",".channel-config-dialog .add-channel-fieldset .add-button, .channel-config-dialog .add-channel-fieldset input",function(Ak){if(((Ak.type=="click"||Ak.which!=13)&&this.type=="text")||(Ak.type=="keydown"&&this.type=="button"&&Ak.which!=13)){return true}var An=(this.type=="text")?AU(this):AU(this).prev();var Al=AU.trim(An.val());if(Al&&Al!=An.prop("defaultValue")){var Am=AU("#top-level-forum .channel-config-dialog .channel-list");Ae(Am,"","",vBulletin.htmlEntities(Al),0,true,0);F(Am);K();An.val("");if(this.type=="button"){An.focus()}}else{openAlertDialog({title:vBulletin.phrase.get("warning_gcpuser"),message:vBulletin.phrase.get("please_enter_channel_title"),iconType:"warning",onAfterClose:function(){An.focus()}})}});AU(document).on("click",".channel-config-dialog .main-channel-container .channel-item .channel-title div",function(){AU(this).hide();var Ak=AU(this).next();Ak.show();Ak.select();Ak.focus()});AU(document).on("keydown blur",".channel-config-dialog .main-channel-container .channel-item .channel-title input",function(Ak){if(Ak.type=="focusout"||(Ak.type=="keydown"&&Ak.which==13)){if(!AU.trim(this.value)&&Ak.type=="focusout"){this.value=this.defaultValue}if(AU.trim(this.value)){AU(this).hide();AU(this).prev().text(this.value);AU(this).prev().show()}}});AU(document).on("click",".channel-config-dialog .channel-item .category-to-channel a",function(){var Ak=AU(this).closest(".channel-item");Ak.attr("data-switch-category",0);AU(this).parent().removeClass("category-to-channel").addClass("channel-to-category");AU(this).html(vBulletin.phrase.get("make_category"));return false});AU(document).on("click",".channel-config-dialog .channel-item .channel-to-category a",function(){var Ak=AU(this).closest(".channel-item");Ak.attr("data-switch-category",1);AU(this).parent().removeClass("channel-to-category").addClass("category-to-channel");AU(this).html(vBulletin.phrase.get("make_forum"));return false});AU(document).on("click",".channel-config-dialog .channel-item .toggle-button",function(){Ab(AU(this));return false});AU(document).on("click",".channel-config-dialog .channel-item .add-subchannel-button a",function(){var Ak=AU(this).parent().siblings(".toggle-button");Ab(Ak,true);var Am=AU(this).closest(".channel-item-container");var Al=AO("","",vBulletin.phrase.get("new_channel"),0,Am,0);U(Am);Al.slideDown(100,function(){var An=Am.find(".channel-item-inner").first().find(".num-subchannels");An.text(parseInt(An.text())+1);AU(".channel-title div",Al).click();AU(".channel-title input",Al).get(0).scrollIntoView(false);K()});return false});AU(document).on("click",".channel-config-dialog .channel-list .channel-item .close-button",function(){var Al=AU(this),Am=AU("> .sub-channel-container > .channel-item-container",Al.closest(".channel-item-container")).length>0,Ak=vBulletin.htmlEntities(Al.prev().text());openConfirmDialog({title:vBulletin.phrase.get("remove_forum_q"),message:vBulletin.phrase.get("do_you_want_to_remove_forum",Ak,(Am)?" "+vBulletin.phrase.get("subchannels_will_be_deleted"):""),iconType:"warning",onClickYes:function(){var Ar=Al.closest(".channel-item-container");var Ap=Ar.parent();var Ao=Al.closest(".channel-item").attr("data-channel-id");AU("body").css("cursor","wait");var An=function(){Ar.remove();if(Ap.hasClass("main-channel-container")){Ap.slideUp("fast",function(){AU(this).remove()})}};var Aq=function(){AU("body").css("cursor","auto")};if(Ao){AU.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/content_channel/delete",data:{nodeid:Ao},type:"POST",dataType:"json",complete:Aq,success:function(As){console.log("Delete channel successful! result:"+JSON.stringify(As));if(As.errors){openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get(As.errors[0]),iconType:"error"})}else{An()}},error:function(Au,At,As){console.log("Delete channel failed! result:"+As);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_deleting_page",Au.status),iconType:"error"})}})}else{An();Aq()}}})})}function Ag(Al){function Ak(An,Ao,Am){vBulletin.AJAX({url:vBulletin.getAjaxBaseurl()+("/ajax/render/{0}_list").format(An),data:{page:Ao},complete:function(){AU("#config-dialog .loader").hide();AU("body").css("cursor","auto")},success:function(Ap){AU(("#top-level-{0} .channel-config-dialog").format(An)).html(Ap);if(Am){vBulletin.pagination({context:("#top-level-{0} .channel-config-dialog").format(An),onPageChanged:function(Aq,Ar){Ak(An,Aq)}})}},error_phrase:"error_fetching_channels"})}Ak(Al,1,true);AU(document).on("click",".page_manager_table .channel_name div",function(){AU(this).hide();var Am=AU(this).next();Am.show();Am.select();Am.focus()});AU(document).on("keydown blur",".page_manager_table .channel_name input",function(Ao){if(Ao.type=="focusout"||(Ao.type=="keydown"&&Ao.which==13)){if(!AU.trim(this.value)&&Ao.type=="focusout"){this.value=this.defaultValue}var An=AU.trim(this.value);var Am=AU(this);if(An&&Am.prev().html()!=An){AU("body").css("cursor","wait");vBulletin.AJAX({url:vBulletin.getAjaxBaseurl()+"/ajax/api/Content_Channel/update",data:{nodeid:Am.parents(".channel_row").data("nodeid"),data:{title:An}},complete:function(){AU("#config-dialog .loader").hide();AU("body").css("cursor","auto")},success:function(Ap){Am.hide();Am.prev().html(An);Am.prev().show()},error_phrase:"error_saving_page"})}}});AU(document).on("click",".page_manager_table .delete",function(){var Am=AU(this);openConfirmDialog({title:vBulletin.phrase.get("remove_channel_q"),message:vBulletin.phrase.get("do_you_want_to_remove_channel",Am.parents(".channel_row").find(".channel_name_val").text()),iconType:"warning",onClickYes:function(){AU("body").css("cursor","wait");vBulletin.AJAX({url:vBulletin.getAjaxBaseurl()+"/ajax/api/content_channel/delete",data:{nodeid:Am.parents(".channel_row").data("nodeid")},complete:function(){AU("body").css("cursor","auto")},success:function(An){Am.parents(".channel_row").remove()}})}})})}var G=false;function AD(){AU("body").css("cursor","wait");var Ak=function(Am){var Al=Am.index();if(Al==0&&!G){AJ()}if((Al==1||Al==2)){Ag(AU(Am.context).data("top-level"))}};n=AU("#manage-pages").tabs({beforeActivate:function(An,Ao){var Am=Ao.newTab.index();if(Am!=0&&v){var Al=openConfirmDialog({title:vBulletin.phrase.get("exit_without_saving_page"),message:vBulletin.phrase.get("forum_changes_will_be_lost"),iconType:"warning",onClickYes:function(){v=false;n.tabs("option","active",Am)}});return false}},create:function(Al,Am){Ak(Am.tab)},activate:function(Al,Am){Ak(Am.newTab)}});n.tabs("option","active",0);AU("#manage-page-dropdown .lnkSaveChanges").on("click",function(){console.log("Saving forum/channel data");var Al=AU(this);if(Al.hasClass("h-disabled")){console.log("We're busy saving already. Try again later.");return }Al.addClass("h-disabled");vBulletin.loadingIndicator.show();AU("body").css("cursor","wait");var Am=[];function An(Aq,Ao,Ap){var Ar=AU("> .channel-item-container",Aq);if(Ar.length>0){Ar.each(function(At){var As=AU("> .channel-item",this);var Au=As.attr("data-channel-id");var Av=As.attr("data-parent-id");subchannelObj={nodeid:Au||"0",previousParentId:Av,title:AU(".channel-title div",As).html(),displayorder:At+1,parentid:Ap||"0",subchannels:[]};if(As.attr("data-switch-category")!=null){subchannelObj.switchCategory=As.attr("data-switch-category")}Ao.subchannels.push(subchannelObj);An(As.next(".sub-channel-container"),Ao.subchannels[At],Au)})}}if(o.forum){AU(".channel-config-dialog .channel-list .main-channel-container").each(function(Aq){var Ap=AU("> .channel-item-container > .channel-item",this);var Ar=Ap.attr("data-channel-id");var As=Ap.attr("data-parent-id");var Ao={nodeid:Ar,previousParentId:As,title:AU(".channel-title div",Ap).html(),displayorder:Aq+1,subchannels:[]};if(Ap.attr("data-switch-category")!=null){Ao.switchCategory=Ap.attr("data-switch-category")}An(Ap.next(".sub-channel-container"),Ao,Ar);Am.push(Ao)});vBulletin.AJAX({url:vBulletin.getAjaxBaseurl()+"/ajax/api/widget/saveForums",data:{data:JSON.stringify(Am)},complete:function(){AU("body").css("cursor","auto");vBulletin.loadingIndicator.hide();Al.removeClass("h-disabled")},success:function(Ao){console.log("Forum/channel changes successfully saved");if(Ao&&Ao.forums&&Ao.forums.length>0){v=false;o.forum=false;location.reload(true)}else{openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_saving_forums"),iconType:"error"});return false}},error_phrase:"error_saving_channels_code"})}else{console.log("No forum/channel changes to save");vBulletin.loadingIndicator.hide();AU("body").css("cursor","auto");Al.removeClass("h-disabled")}});AU(document).on("click","#manage-page-dropdown .lnkExitWithoutSaving",function(){if(v){openConfirmDialog({title:vBulletin.phrase.get("exit_without_saving_page"),message:vBulletin.phrase.get("do_you_want_to_exit_without_saving_page"),iconType:"warning",onClickYes:function(){location.reload(true)}})}else{location.reload(true)}})}function Q(){AU(document).on("focus click",".edit-mode .widget-content a, .edit-mode #channel-tabbar a, .edit-mode #btnSearch, .edit-mode #q",function(Ar){this.blur();return false});if(!AF){AY()}if(!y){p()}else{a.thumbnailRadioCheckbox("check",AU("#select-template .template-border.selected").next("input"),false);if(!t){AU("#select-template .template-item input[value={0}]".format(AU("#pagetemplateid-yes").val())).prev().trigger("click")}}if(AU.isEmptyObject(AN)){m()}Aj();AU("#config_pagetemplateid").val("");q=undefined;if(t){AU("#save-page-form #pagetitle").val("");AU("#save-page-form #pageurl").val("");AU("#save-page-form #pagetemplateid").val("0");AU("#save-page-form #pageid").val("0")}AU("#edit-page-dropdown .lnkDeletePage").on("click",function(){openConfirmDialog({title:vBulletin.phrase.get("confirm_deletion_gcpglobal"),message:vBulletin.phrase.get("confirm_remove_page_desc"),buttonLabel:{yesLabel:vBulletin.phrase.get("delete_page"),noLabel:vBulletin.phrase.get("cancel")},iconType:"warning",onClickYes:function(){vBulletin.AJAX({url:vBulletin.getAjaxBaseurl()+"/ajax/api/page/delete",data:{pageid:pageData.pageid},dataType:"json",complete:function(){AU("body").css("cursor","auto")},success:function(Ar){console.log("deleted page "+pageData.pageid);window.location.href=pageData.baseurl},error:function(At,As,Ar){console.log("page delete  failed! result:"+Ar);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_deleting_page",At.status),iconType:"error"})}})}})});AU("#edit-page-dropdown .lnkSaveChanges").on("click",function(){AU("#edit-page-dropdown .tabs li").removeClass("ui-tabs-active ui-state-active");AU("#edit-page-dropdown .tabs .tab").addClass("ui-tabs-hide");AU("#save-content").show();AU("#save-page-form .edit-page-template").css("display","");AU("#save-page-form .edit-page-template").prev("label").css("display","");if(AU("body").hasClass("lnkNewPage")){AU("#save-page-form .new-page-template input").prop("disabled",false);AU("#save-page-form .edit-page-template input").prop("disabled",true)}else{if(!AU("#pagetemplateid-yes").prop("checked")&&!AU("#pagetemplateid-no").prop("checked")){AU("#pagetemplateid-yes").prop("checked",true)}AU("#save-page-form .edit-page-template input").prop("disabled",false);AU("#save-page-form .new-page-template input").prop("disabled",true);if(t&&(!s&&!v)){AU("#save-page-form .edit-page-template").css("display","none");AU("#save-page-form .edit-page-template").prev("label").css("display","none")}if(AU("#pagetemplateid-yes").prop("checked")){AU("#save-page-form #templatetitle").prop("disabled",false);AU("#save-page-form #templatetitle-edit").prop("disabled",true);AU("#save-page-form .page-template-name").removeClass("h-hide")}else{AU("#save-page-form #templatetitle").prop("disabled",true);AU("#save-page-form #templatetitle-edit").prop("disabled",false);AU("#save-page-form .page-template-name").addClass("h-hide")}}});AU(document).on("click","#edit-page-dropdown .lnkExitWithoutSaving",function(){if(s||v||l||(!t&&(AU("#pagetitle").val()!=AU("#pagetitle").prop("defaultValue")||AU("#pageurl").val()!=AU("#pageurl").prop("defaultValue")))||(t&&(AU("#pagetitle").val()!=""||AU("#pageurl").val()!=""))){openConfirmDialog({title:vBulletin.phrase.get("exit_without_saving_page"),message:vBulletin.phrase.get("do_you_want_to_exit_without_saving_page"),iconType:"warning",onClickYes:function(){var Ar=parseInt(AU("input#pagetemplateid-new").val(),10);if(!isNaN(Ar)&&Ar>0){vBulletin.AJAX({call:"/ajax/api/page/deleteOrphanedPagetemplates",data:{pagetemplateids:[Ar]},success:function(As){console.log({msg:"/ajax/api/widget/deleteOrphanedPagetemplates success!",result:As,})},complete:function(){location.reload(true)},})}else{location.reload(true)}}})}else{location.reload(true)}});var Ak=0;AU(window).on("resize.canvas",function(){clearTimeout(Ak);Ak=setTimeout(O,200)});var An=function(Ar){return'<label class="hide-icon module-button-item"><input type="checkbox" title="{0}" data-toggle-title="{1}"{2} /></label>'.format(vBulletin.phrase.get("check_to_hide_module"),vBulletin.phrase.get("uncheck_to_unhide_module"),Ar?' checked="checked"':"")};AU(".canvas-widget.container-widget .canvas-widget:not(.dummy-widget)").each(function(){var Ar=AU(this).hasClass("hidden-widget");AU(".module-buttons .admin-only",this).prepend(An(Ar));if(Ar){AU(".module-buttons .admin-only .hide-icon input",this).trigger("click").prop("checked",true)}});var Aq=function(At,Au,Aw){var Av=Au.item,Aw=Au.item.hasClass("module-item");var Ar=AU("> .canvas-widget.container-widget {0}".format(Aw?".module-item":".canvas-widget.container-widget"),this);if(Ar.length>0){var As=Ar.closest(".canvas-widget.container-widget");if(As.attr("data-widget-id")==Ar.attr("data-widget-id")){if(Aw){Ar.remove()}else{if(Au.sender){Au.sender.sortable("cancel")}else{AU(this).sortable("cancel")}}Ao=true;openAlertDialog({title:vBulletin.phrase.get("move_not_allowed"),message:vBulletin.phrase.get("dropping_container_module_into_container_module_not_allowed"),iconType:"warning"});return true}return false}return false};var Am=function(Ar){if(Ar.parents(".canvas-widget.container-widget").length>0){if(AU(".module-buttons .admin-only .hide-icon",Ar).length==0){AU(".module-buttons .admin-only",Ar).prepend(An())}}else{Ar.removeClass("hidden-widget").find("> .widget-header .module-buttons .admin-only .hide-icon").remove()}};var Ao=false;AM=AU(".edit-mode .canvas-layout .canvas-widget-list:not(.js-draggable-module-target)");AM.sortable({revert:true,tolerance:"pointer",connectWith:".edit-mode .canvas-layout:visible .canvas-widget-list",placeholder:"canvas-widget canvas-widget-highlight drag-highlight",create:function(){O();z()},update:function(As,At){var Aw=this;if(AZ){if(!Ao){Ah(At.item,function(A0){At.item.replaceWith(A0);A0.filter(":not(.container-widget)").find(".toggle-button").trigger("click",[true]);if(!Aq.apply(Aw,[As,At])){Am(A0);A0.addClass("shadow").find(".widget-tabs").andSelf().filter(".widget-tabs").tabs();M();A0.parents(".canvas-widget.container-widget").find(".canvas-widget.dummy-widget").remove();var A1=A0.parents(".canvas-widget.container-widget");if(A1.length==1){A1.find(".canvas-widget-highlight").remove();A1.find(".module-item").remove()}}var Ay=A0.data("widget-id"),Ax=r(A0),Az=function(A2){A0.attr("data-widget-instance-id",A2);if(Ax){R(A0)}i(A0)};if(Ay){j(Ax,Ay,{},Az)}})}}else{if(!Aq.apply(Aw,[As,At])){Am(At.item);M()}if(AU.contains(this,At.item[0])){var Av=At.item.closest(".canvas-widget"),Ar=r(Av),Au=Av.data("widget-instance-id")||0;R(Av);if(Au){vBulletin.AJAX({call:"/ajax/api/widget/saveWidgetinstanceContainerinstanceid",data:{widgetinstanceid:Au,containerinstanceid:Ar},success:function(Ax){console.log("saveWidgetinstanceContainerinstanceid success: "+JSON.stringify(Ax))}})}}}if(At.sender){var Av=At.sender.closest(".canvas-widget");if(Av.length){R(Av)}}s=true},out:function(Ar,As){AU(this).css("overflow","")},sort:function(Ar,As){if(u){AZ=true}var At=As.placeholder.closest(".canvas-widget.container-widget");if(At.length==1&&At.find(".canvas-widget:last-child").hasClass("canvas-widget-highlight")){As.placeholder.css({"margin-bottom":0,"margin-top":-3})}else{As.placeholder.css({"margin-bottom":"","margin-top":""})}},start:function(Ar,As){E("hidden",As.item)},over:function(Ar,As){},stop:function(As,At){AU(this).css("overflow","");Ao=false;z();AZ=false;At.item.height("auto");E("visible");AU(".canvas-layout .canvas-widget-list .canvas-widget-highlight").remove();var Ar=AU(".canvas-layout > .canvas-layout-row .canvas-widget-list > .canvas-widget.container-widget");AU(".canvas-layout > .canvas-layout-row .canvas-widget-list > .canvas-widget.container-widget").each(function(){var Au=AU(".canvas-widget-list",this);if(Au.children().length==0){Au.append('<div class="canvas-widget dummy-widget"><span>{0}</span></div>'.format(vBulletin.phrase.get("you_can_also_drag_and_drop_modules_here")))}else{if(Au.find(".canvas-widget.dummy-widget").length>0&&Au.find(".canvas-widget:not(.dummy-widget,.canvas-widget-highlight)").length>0){Au.find(".canvas-widget.dummy-widget").remove()}}})},receive:function(Ar,As){if(As.item.hasClass("module-item")){Aq.apply(this,[Ar,As,true])}},handle:".move-icon",items:".canvas-widget:not(.js-widget-non-sortable,.js-widget-pinned-sortable)",}).find(".canvas-widget .widget-header").disableSelection();AU(document).on("click",".edit-mode .canvas-widget .js-pin-module-button",function(){var Aw=AU(this),Av=Aw.closest(".canvas-widget"),Ar=Av.find("js-move-button"),Au="js-widget-pinned-sortable",At="pin-icon--pinned",As=Av.hasClass(Au);Av.toggleClass(Au,!As);Aw.toggleClass(At,!As)});AU(document).on("click",".edit-mode .canvas-widget .close-button",function(){var Ar=AU(this);openConfirmDialog({title:vBulletin.phrase.get("remove_module_q"),message:vBulletin.phrase.get("do_you_want_to_remove_module",Ar.closest(".widget-header").find(".module-title").text()),iconType:"warning",onClickYes:function(){var Av=Ar.closest(".canvas-widget"),Au=Av.data("widget-instance-id"),At=Av.parent(),As=Av.parents(".canvas-widget.container-widget");Av.remove();z();M();s=true;AP([Au]);R(At);if(As.find(".canvas-widget").length==0){As.find(".canvas-widget-list").append('<div class="canvas-widget dummy-widget"><span>{0}</span></div>'.format(vBulletin.phrase.get("you_can_also_drag_and_drop_modules_here")))}}})});AU(document).on("click",".edit-mode .js-search-widget .edit-button",function(){E("hidden");Al(AU(this).closest(".js-search-widget"));AU("#search-config-dialog").dialog("open");return false});function Ap(A1,A0){var Ar=AU("#edit-page-dropdown .lnkSaveChanges .label").text();if(!A0){if(!AU.trim(AU("#save-page-form #pagetitle").val())){openAlertDialog({title:Ar,message:vBulletin.phrase.get("please_enter_page_name"),iconType:"warning",onAfterClose:function(){AU("#save-page-form #pagetitle").focus()}});return false}if(AU("body").hasClass("lnkEditPage")){var Az=AU("#save-page-form #pagetemplateid-yes");var As=AU("#save-page-form #pagetemplateid-no");if(!Az.prop("checked")&&!As.prop("checked")){openAlertDialog({title:Ar,message:vBulletin.phrase.get("please_choose_overwrite_template_options"),iconType:"warning",onAfterClose:function(){AU("#save-page-form #pagetemplateid-yes").focus()}});return false}else{if(As.prop("checked")){var At=AU("#save-page-form #templatetitle-edit");var A5=AU.trim(At.val());if(!A5||A5==At.prop("defaultValue")){openAlertDialog({title:Ar,message:vBulletin.phrase.get("please_enter_new_template_name"),iconType:"warning",onAfterClose:function(){AU("#save-page-form #templatetitle-edit").focus()}});return false}openConfirmDialog({title:Ar,message:vBulletin.phrase.get("applying_new_template",AU("#save-page-form #templatetitle-edit").val()),buttonLabel:{yesLabel:vBulletin.phrase.get("save_page"),noLabel:vBulletin.phrase.get("cancel")},iconType:"warning",onClickYes:function(){},onAfterClose:function(){if(AU(this).attr("id")=="btnConfirmDialogYes"){AU("#save-page-form #btnOK").trigger("click",true)}}});return false}else{if(Az.prop("checked")){if(t&&(!s&&!v)){AU("#save-page-form #btnOK").trigger("click",true)}else{openConfirmDialog({title:Ar,message:vBulletin.phrase.get("overwrite_template_continue"),buttonLabel:{yesLabel:vBulletin.phrase.get("save_page"),noLabel:vBulletin.phrase.get("cancel")},iconType:"warning",onClickYes:function(){},onAfterClose:function(){if(AU(this).attr("id")=="btnConfirmDialogYes"){AU("#save-page-form #btnOK").trigger("click",true)}}})}return false}}}}else{var At=AU("#save-page-form #templatetitle-new");var A5=AU.trim(At.val());if(!A5||A5==At.prop("defaultValue")){openAlertDialog({title:Ar,message:vBulletin.phrase.get("please_enter_new_template_name"),iconType:"warning",onAfterClose:function(){AU("#save-page-form #templatetitle-new").focus()}});return false}}}var A4=AU(".canvas-layout:visible");Ac=A4.attr("id");var Ay=parseInt(A4.attr("data-layout-id"),10);AU("#save-page-form #screenlayoutid").val(Ay);function Au(A9){var BA={widgetId:A9.attr("data-widget-id"),widgetInstanceId:(A9.attr("data-widget-instance-id")||"0")};if(A9.hasClass("container-widget")){var A6=[];var A8=[];AU("div.canvas-widget-list > div.canvas-widget",A9).each(function(BB){if(!AU(this).hasClass("hidden-widget")){A8.push(AU(this).attr("data-widget-instance-id"))}A6.push(Au(AU(this)))});BA.subModules=A6;BA.displaySubModules=A8}if(A9.data("is-tabbed-container")){var A7=[];A9.find("> .js-admin-widget-content > .js-admin-widget-tab").each(function(){var BB=AU(this);BB.find("> .widget-content > .canvas-layout-row > .canvas-widget-list > .canvas-widget:not(.dummy-widget)").each(function(){var BC=AU(this);A7.push(Au(BC))})});BA.tabbedContainerSubModules=A7}return BA}AU('input[type=hidden][name*="displaysections"]',A4).clone().appendTo(AU("#moduleData").empty());AU("#"+Ac+" > .canvas-layout-row > div.canvas-widget-list").each(function(){var A6=[];var A7=J(this);AU(this).children("div.canvas-widget").each(function(){A6.push(Au(AU(this)))});AU('#save-page-form input[name="displaysections['+A7+']"]').val(JSON.stringify(A6))});var A2={};var Ax=AU("#save-page-form").serializeArray();AU.each(Ax,function(A6,A7){A2[A7.name]=A7.value});function A3(A6){AU.ajax({url:vBulletin.getAjaxBaseurl()+"/admin/savepage",data:{input:A6,url:window.location.href},type:"POST",dataType:"json",complete:function(){AU("body").css("cursor","auto")},success:function(A7){console.log("savePage successful! result:"+JSON.stringify(A7));if(A7&&A7.url!=null){window.location.href=pageData.baseurl+A7.url}else{openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get(A7.errors[0]),iconType:"error"})}},error:function(A9,A8,A7){console.log("saveChannelWidgetConfig failed! result:"+A7);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_saving_page",A9.status),iconType:"error"})}})}var Av=AU("input[name='screenlayoutid'][value='"+Ay+"']");if(Av.length>0&&Av.attr("data-guid")=="vbulletin-screenlayout-bare-full-57433eecd10803.93763070"){var Aw={title:vBulletin.phrase.get("warning"),message:vBulletin.phrase.get("you_cannot_revert_this_layout_confirm"),onClickYes:function(){A3(A2)}};openConfirmDialog(Aw)}else{A3(A2)}}AU(document).on("click","#save-page-form #btnOK",Ap);AU("#config-dialog").dialog({title:vBulletin.phrase.get("module_configuration"),autoOpen:false,modal:true,resizable:false,closeOnEscape:false,showCloseButton:false,height:500,width:800,dialogClass:"dialog-container config-dialog-container input-dialog",open:function(){AU("#config-dialog .loader").show();AU("body").css("cursor","wait")},create:function(){AU(document).on("submit",".sitebuilder-widget-form",function(){function As(Au){AU("body").css("cursor","wait");AU("#config-dialog .js-button").prop("disabled",true);var Av=AU("#config-dialog").data("selected-module");var At=Au.action;AU.ajax({url:At,type:Au.method,data:(AU(Au).serializeArray()),dataType:"json",success:function(Ax){console.log("saveAdminConfig successful!");AU("body").css("cursor","auto");if(Ax&&Ax.data){var Aw=Ax.data.title||Ax.data.searchResultTitle||Ax.data.searchTitle;if(Aw){Av.find(".module-title .admin-only").text(vBulletin.phrase.get("x_module",Aw))}switch(Ax.data.widget_type){case"custom-html-widget":Av.find(".widget-content").html(Ax.data.html);k(Av,true);break;case"video-widget":var Ay=Ax.data.embed_data;if(Ay){var A1=Av.find(".widget-content .videocontainer");if(A1.length==0){A1=AU("<div />").addClass("videocontainer").appendTo(Av.find(".widget-content"))}var A0={code:Ay.code,provider:Ay.provider,width:"100%",height:260};AU.post(vBulletin.getAjaxBaseurl()+"/ajax/render/bbcode_video",A0,function(A2){if(A2){A1.empty().append(A2);k(Av,true)}},"json");Av.find(".widget-content").find(".note").addClass("h-hide")}break}var Az=AU('select[name="data[default_tab]"]',AU(Au));if(Az.length>0){Av.attr("data-widget-default-tab",Az.val())}v=true}else{openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("invalid_server_response_please_try_again"),iconType:"error",onAfterClose:function(){AU("#config-dialog .js-button").prop("disabled",false)}});AU("#config-dialog .loader").hide()}AU("#config-dialog").dialog("close")},error:function(Ay,Ax,Aw){console.log("saveAdminConfig failed! error:"+Aw);AU("body").css("cursor","auto");openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_saving_configuration_module",AU("#config-dialog .widget-name h1").text()),iconType:"error",onAfterClose:function(){AU("#config-dialog .js-button").prop("disabled",false)}});AU("#config-dialog .loader").hide()}})}var Ar=this;As(Ar);return false});AU("#btnCloseConfig").on("click",function(){AU(".channel-config-dialog .channel-list").empty();AU("#config-dialog").dialog("close")})},close:function(){E("visible");AU("#config-dialog .dialog-content .channel-config-dialog").css("display","none");AU("#config-dialog .js-button").prop("disabled",false)}});AU("#pagetitle").on("keyup blur",function(Ar){if(t){AU("#pageurl").val(this.value.replace(/[^\w-]+/g,""))}return true});AU("#save-page-form #pagetemplateid-yes").on("click",function(){AU("#save-page-form .template-name").addClass("h-hide");AU("#save-page-form #templatetitle").prop("disabled",false);AU("#save-page-form #templatetitle-edit").prop("disabled",true);AU("#save-page-form .page-template-name").removeClass("h-hide")});AU("#save-page-form #pagetemplateid-no").on("click",function(){AU("#save-page-form .template-name").removeClass("h-hide");AU("#save-page-form #templatetitle").prop("disabled",true);AU("#save-page-form #templatetitle-edit").prop("disabled",false);AU("#save-page-form .page-template-name").addClass("h-hide")});function Al(Ar){if(typeof h.search_config_dialog=="undefined"){vBulletin.AJAX({url:vBulletin.getAjaxBaseurl()+"/ajax/render/dialog_search_config",success:function(As){h.search_config_dialog=As;AU("body").append(As);Al(Ar)},error_phrase:"error_fetching_dialog"});return }if(Ar){AU("#search-config-dialog").data("search-widget",Ar)}AU("#search-config-dialog").dialog({title:vBulletin.phrase.get("edit_search_module"),autoOpen:true,modal:true,resizable:false,closeOnEscape:false,showCloseButton:false,width:800,dialogClass:"dialog-container search-config-dialog-container input-dialog",close:function(){E("visible")},open:function(){var As=this;AU("#customSearchDialog",As).addClass("h-invisible");AU("body").css("cursor","wait");setTimeout(function(){vBulletin.search=vBulletin.search||{};var Av=function(){S=new vBulletin.search.SearchControl("#customSearchDialog");T(S)};var Au=AU("#search-config-dialog").data("search-widget");var Ax={id:Au.attr("data-widget-id"),instanceid:Au.attr("data-widget-instance-id")};if(typeof vBulletin.search.SearchControl=="undefined"){var Aw=["/js/jquery/jquery.qtip.min.js","/js/tag-editor.js","/js/sb_search.js"];var At=function(){if(Aw.length==0){AU("body").css("cursor","auto");AU("#customSearchDialog",As).removeClass("h-invisible");Av();return }var Ay=Aw.shift();AU.getScript(vBulletin.getAjaxBaseurl()+Ay+"?"+pageData.simpleversion,At).error(function(A2,A1,Az){var A0=(Az&&Az.message)?"{0}: {1}".format(vBulletin.phrase.get("error"),Az.message):"HTTP {0}: {1}".format(A2.status,A2.statusText);AU("#search-config-dialog").dialog("close");openAlertDialog({title:vBulletin.phrase.get("error"),message:"{0}<br /><br />({1})".format(vBulletin.phrase.get("error_loading_search_config_script"),A0),iconType:"error"})}).complete(function(){})};At()}else{AU("#customSearchDialog",As).removeClass("h-invisible");Av()}},1);v=false},create:function(){AU("#btnSaveSearchConfig").on("click",function(){AU("body").css("cursor","wait");var Au=AU("#search-config-dialog").data("search-widget");var A2={id:Au.attr("data-widget-id"),instanceid:Au.attr("data-widget-instance-id")};var Ax={pageid:pageData.pageid,widgetid:A2.id,widgetinstanceid:A2.instanceid,pagetemplateid:AU("#select-template input[type=radio]:checked").val(),searchJSON:{}};var A6=AU("#searchTitle");if(A6.length>0&&AU.trim(A6.val()).length>0){Ax.searchTitle=AU.trim(A6.val());A6.data("defaultValue",Ax.searchTitle)}var Az=AU("#resultsPerPage");if(Az.length>0&&AU.trim(Az.val()).length>0){Ax.resultsPerPage=AU.trim(Az.val());Az.data("defaultValue",Ax.resultsPerPage)}var Av=["hide_avatars","hide_module_when_empty","displayFooter"];for(var Ay=0;Ay<Av.length;Ay++){var As=Av[Ay],Aw=AU("input[name='"+As+"'][value='1']");if(Aw.length>0&&Aw.prop("checked")){Ax[As]="1";Aw.data("defaultValue","1")}else{Ax[As]="0";Aw.data("defaultValue","0")}}var A1=AU(".js-searchmodule-show-at-breakpoints");if(A1.length>0){Ax.show_at_breakpoints={desktop:1,small:1,xsmall:1};A1.find("input").each(function(){var A7=AU(this);switch(A7.prop("name")){case"show_at_breakpoints[desktop]":Ax.show_at_breakpoints.desktop=A7.prop("checked")?1:0;break;case"show_at_breakpoints[small]":Ax.show_at_breakpoints.small=A7.prop("checked")?1:0;break;case"show_at_breakpoints[xsmall]":Ax.show_at_breakpoints.xsmall=A7.prop("checked")?1:0;break}});A1.data("defaultValue",Ax.show_at_breakpoints)}var A5=AU("#search-config-dialog .js-sb-module-config--viewpermissions");if(A5.length>0){Ax.module_viewpermissions={};var A0=A5.find("input.js-module_viewpermissions__key:checked"),A4="show_all",At=A5.find("input.js-module_viewpermissions__value:checked"),A3="all";if(A0.length){A4=A0.prop("value")}if(At.length){A3=[];AU.each(At,function(A7,A8){A3.push(AU(A8).prop("value"))})}Ax.module_viewpermissions={key:A4,value:A3,}}Ax.searchJSON=S.load();AU.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/widget/saveSearchWidgetConfig",data:{data:JSON.stringify(Ax)},type:"POST",dataType:"json",complete:function(){AU("body").css("cursor","auto")},success:function(A7){console.log("savesearchWidgetConfig successful! result:"+JSON.stringify(A7));if(A7&&A7.widgetinstanceid>0&&A7.searchJSON){Au.attr("data-widget-instance-id",A7.widgetinstanceid);Au.find(".main-title").text(Ax.searchTitle);AU("#config_widgetinstanceid").val(A7.widgetinstanceid);AU("#config_pagetemplateid").val(A7.pagetemplateid);AU("#pagetemplateid-new").val(A7.pagetemplateid);AU("#search-config-dialog").dialog("close");k(Au,true);v=true}else{openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_saving_search_config"),iconType:"error"})}},error:function(A9,A8,A7){console.log("saveSearchWidgetConfig failed! result:"+A7);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_saving_search_config_code",A9.status),iconType:"error"})}})});AU("#btnCancelSearchConfig").on("click",function(){function As(){AU("#search-config-dialog").dialog("close");S.set("{}");var A2=AU("#search-config-dialog #searchTitle");A2.val(A2.data("defaultValue"));var Ay=AU("#search-config-dialog #resultsPerPage");Ay.val(Ay.data("defaultValue"));var Av=["hide_avatars","hide_module_when_empty","displayFooter"];for(var Ax=0;Ax<Av.length;Ax++){var Au=Av[Ax],Aw=AU("#search-config-dialog input[name='"+Au+"'][value='1']"),Az=AU("#search-config-dialog input[name='"+Au+"'][value='0']");if(Aw.data("defaultValue")=="1"){Aw.prop("checked",true)}else{Az.prop("checked",true)}}var A0=AU("#search-config-dialog .js-searchmodule-show-at-breakpoints");if(A0.length>0){var A1=A0.data("defaultValue");if(typeof (A1)!="undefined"){A0.find("input").each(function(){var A3=AU(this);switch(A3.prop("name")){case"show_at_breakpoints[desktop]":A3.prop("checked",A1.desktop?"checked":"");break;case"show_at_breakpoints[small]":A3.prop("checked",A1.small?"checked":"");break;case"show_at_breakpoints[xsmall]":A3.prop("checked",A1.xsmall?"checked":"");break}})}}}if(v){var At=AU(this);openConfirmDialog({title:vBulletin.phrase.get("cancel_edit"),message:vBulletin.phrase.get("do_you_want_to_cancel_editing_search_module"),iconType:"warning",onClickYes:As})}else{As()}})}})}AU("#blog-category-dialog").dialog({title:vBulletin.phrase.get("edit_blog_categories"),autoOpen:false,modal:true,resizable:false,closeOnEscape:false,showCloseButton:false,width:800,dialogClass:"dialog-container blog-category-dialog-container input-dialog",close:function(){E("visible")},open:function(){var Ar=this;v=false},create:function(){AU("#blog-category-dialog #btnSaveCategories").on("click",function(){AU("body").css("cursor","wait");AU("#blog-category-dialog dialog-content loader").show();var Ar=AU("#search-config-dialog").data("blog-category-widget");var As={id:Ar.attr("data-widget-id"),instanceid:Ar.attr("data-widget-instance-id")};vBulletin.AJAX({url:vBulletin.getAjaxBaseurl()+"/ajax/api/widget/saveBlogCategories",data:{},complete:function(){AU("body").css("cursor","auto");AU("#blog-category-dialog dialog-content loader").hide()},success:function(At){AU("#blog-category-dialog dialog-content widget-config-container").html(At)},error_phrase:"error_saving_blog_categories"})});AU("#blog-category-dialog #btnNewCategory").on("click",function(){});AU("#blog-category-dialog #btnCloseCategories").on("click",function(){if(v){var Ar=AU(this);openConfirmDialog({title:vBulletin.phrase.get("cancel_edit"),message:vBulletin.phrase.get("do_you_want_to_cancel_editing_blog_categories_module"),iconType:"warning",onClickYes:AU("#blog-category-dialog").dialog("close")})}else{AU("#blog-category-dialog").dialog("close")}})}})}function T(Ak){var Am=AU(this).closest(".canvas-widget");var Al=AU("#search-config-dialog").data("search-widget");var An={id:Al.attr("data-widget-id"),instanceid:Al.attr("data-widget-instance-id")};AU.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/widget/fetchSearchConfig",data:({widgetid:An.id,widgetinstanceid:An.instanceid||"",pagetemplateid:W(),configtype:"admin"}),type:"POST",dataType:"json",complete:function(){AU("body").css("cursor","auto")},success:function(Ay){console.log("fetchSearchConfig successful! result:"+JSON.stringify(Ay));if(Ay.searchTitle){var Ax=AU("#searchTitle");if(Ax.length>0){Ax.val(Ay.searchTitle)}}if(Ay.resultsPerPage){var Au=AU("#resultsPerPage");if(Au.length>0){Au.val(Ay.resultsPerPage)}}var Ar=["hide_avatars","hide_module_when_empty","displayFooter"];for(var At=0;At<Ar.length;At++){var Ap=Ar[At],As=AU("input[name='"+Ap+"'][value='1']"),Av=AU("input[name='"+Ap+"'][value='0']");if(Ay[Ap]&&parseInt(Ay[Ap],10)==1){if(As.length>0){As.prop("checked",true)}}else{if(Av.length>0){Av.prop("checked",true)}}}if(Ay.show_at_breakpoints){var Aw=AU("#search-config-dialog .js-searchmodule-show-at-breakpoints");if(Aw.length>0){Aw.find("input").each(function(){var Az=AU(this);switch(Az.prop("name")){case"show_at_breakpoints[desktop]":Az.prop("checked",Ay.show_at_breakpoints.desktop?"checked":"");break;case"show_at_breakpoints[small]":Az.prop("checked",Ay.show_at_breakpoints.small?"checked":"");break;case"show_at_breakpoints[xsmall]":Az.prop("checked",Ay.show_at_breakpoints.xsmall?"checked":"");break}})}if(Ay.module_viewpermissions){var Aq=AU("#search-config-dialog .js-searchmodule-module_viewpermissions--replaceme"),Ao=C({defaultvalue:Ay.module_viewpermissions});Aq.replaceWith(Ao)}}Ak.set(Ay.searchJSON||{},Ay.contentTypes||{},Ay.channels||{});AU("#config-dialog .dialog-content .widget-config-container").show();AU("#search-config-dialog .form_layout .form_row .field_column select").selectBox();AU("#config-dialog .loader").hide()},error:function(Aq,Ap,Ao){console.log("fetchSearchConfig failed! error:"+Ao);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_retrieving_configuration",widgetName),iconType:"error",onAfterClose:function(){AU("#config-dialog").dialog("close")}});AU("#config-dialog .loader").hide()}})}AU(document).ready(function(){AK()})})(jQuery);